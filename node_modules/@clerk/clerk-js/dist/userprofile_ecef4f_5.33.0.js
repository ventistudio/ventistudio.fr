"use strict";(globalThis.webpackChunk_clerk_clerk_js=globalThis.webpackChunk_clerk_clerk_js||[]).push([["470"],{4019:function(e,t,i){i.r(t),i.d(t,{UserProfile:()=>tt,UserProfileModal:()=>ti});var r=i("2903"),o=i("2784"),l=i("7571"),a=i("3064"),n=i("9885"),s=i("4676"),c=i("1085");let d=e=>{let{pages:t}=(0,l.useUserProfileContext)();return(0,r.BX)(n.NavbarContextProvider,{children:[(0,r.tZ)(n.NavBar,{title:(0,c.u1)("userProfile.navbar.title"),description:(0,c.u1)("userProfile.navbar.description"),routes:t.routes,contentRef:e.contentRef}),e.children]})};var u=i("4995"),m=i("1673"),h=i("9366"),f=i("3314"),p=i("8969"),v=i("9805"),P=i("4709"),g=i("242"),y=i("1132");let Z=e=>{let{strategy:t}=e,i=(0,n.useCardState)(),{user:o}=(0,h.aF)(),{navigate:c}=(0,s.useRouter)(),{strategyToDisplayData:d}=(0,g.vO)(),{additionalOAuthScopes:u,componentName:m,mode:v}=(0,l.useUserProfileContext)(),P="modal"===v,[Z]=(0,h.jJ)(()=>{if(!o)return Promise.resolve(void 0);let e=t.replace("oauth_",""),i=P?(0,f.bX)({url:window.location.href,componentName:m,socialProvider:e}):window.location.href,r=u?u[e]:[];return o.createExternalAccount({strategy:t,redirectUrl:i,additionalScopes:r})}),b=d[t].iconUrl?(0,r.tZ)(a.Image,{isLoading:i.loadingMetadata===t,isDisabled:i.isLoading,elementDescriptor:a.descriptors.providerIcon,elementId:a.descriptors.providerIcon.setId(d[t].id),src:d[t].iconUrl,alt:"Connect ".concat(d[t].name," account"),sx:e=>({width:e.sizes.$4})}):(0,r.tZ)(p.e_,{id:d[t].id,value:d[t].name,isLoading:i.loadingMetadata===t,isDisabled:i.isLoading});return(0,r.tZ)(n.ProfileSection.ActionMenuItem,{id:d[t].id,onClick:()=>{if(o)return i.setLoading(t),Z().then(e=>{var r;e&&(null===(r=e.verification)||void 0===r?void 0:r.externalVerificationRedirectURL)&&((0,y._v)(2e3).then(()=>i.setIdle(t)),c(e.verification.externalVerificationRedirectURL.href))}).catch(e=>{(0,y.S3)(e,[],i.setError),i.setIdle(t)})},isDisabled:i.isLoading,variant:"ghost",isLoading:i.loadingMetadata===t,focusRing:!1,closeAfterClick:!1,localizationKey:(0,a.localizationKeys)("userProfile.connectedAccountPage.socialButtonsBlockButton",{provider:d[t].name}),sx:e=>({justifyContent:"start",gap:e.space.$2}),leftIcon:b},t)},b=()=>{let{user:e}=(0,h.aF)(),{strategies:t}=(0,g.vO)(),i=t.filter(e=>e.startsWith("oauth")),o=null==e?void 0:e.verifiedExternalAccounts.map(e=>"oauth_".concat(e.provider)),l=i.filter(e=>!o.includes(e));return 0===l.length?null:(0,r.tZ)(n.ProfileSection.ActionMenu,{triggerLocalizationKey:(0,a.localizationKeys)("userProfile.start.connectedAccountsSection.primaryButton"),id:"connectedAccounts",children:l.map(e=>(0,r.tZ)(Z,{strategy:e},e))})},S=e=>{var t;let{onSuccess:i,onReset:l}=e,{user:n}=(0,h.aF)(),{emailId:s}=e,c=null==n?void 0:n.emailAddresses.find(e=>e.id===s),d=o.useRef(null==c?void 0:c.emailAddress),u=(null==c?void 0:null===(t=c.verification)||void 0===t?void 0:t.status)==="verified"?(0,a.localizationKeys)("userProfile.emailAddressPage.removeResource.messageLine2"):void 0;return d.current?(0,r.tZ)(p.LE,{title:(0,a.localizationKeys)("userProfile.emailAddressPage.removeResource.title"),messageLine1:(0,a.localizationKeys)("userProfile.emailAddressPage.removeResource.messageLine1",{identifier:d.current}),messageLine2:u,successMessage:(0,a.localizationKeys)("userProfile.emailAddressPage.removeResource.successMessage",{emailAddress:d.current}),deleteResource:()=>Promise.resolve(null==c?void 0:c.destroy()),onSuccess:i,onReset:l}):null},C=e=>{var t;let{phoneId:i,onSuccess:l,onReset:n}=e,{user:s}=(0,h.aF)(),c=null==s?void 0:s.phoneNumbers.find(e=>e.id===i),d=o.useRef(null==c?void 0:c.phoneNumber),u=(null==c?void 0:null===(t=c.verification)||void 0===t?void 0:t.status)==="verified"?(0,a.localizationKeys)("userProfile.phoneNumberPage.removeResource.messageLine2"):void 0;return d.current?(0,r.tZ)(p.LE,{title:(0,a.localizationKeys)("userProfile.phoneNumberPage.removeResource.title"),messageLine1:(0,a.localizationKeys)("userProfile.phoneNumberPage.removeResource.messageLine1",{identifier:d.current}),messageLine2:u,successMessage:(0,a.localizationKeys)("userProfile.phoneNumberPage.removeResource.successMessage",{phoneNumber:d.current}),deleteResource:()=>Promise.resolve(null==c?void 0:c.destroy()),onSuccess:l,onReset:n}):null},z=e=>{var t,i;let{accountId:l,onSuccess:n,onReset:s}=e,{user:c}=(0,h.aF)(),d=null==c?void 0:c.externalAccounts.find(e=>e.id===l),u=o.useRef(null==d?void 0:d.provider),{providerToDisplayData:m}=(0,g.vO)();return u.current?(0,r.tZ)(p.LE,{title:(0,a.localizationKeys)("userProfile.connectedAccountPage.removeResource.title"),messageLine1:(0,a.localizationKeys)("userProfile.connectedAccountPage.removeResource.messageLine1",{identifier:null===(t=m[u.current])||void 0===t?void 0:t.name}),messageLine2:(0,a.localizationKeys)("userProfile.connectedAccountPage.removeResource.messageLine2"),successMessage:(0,a.localizationKeys)("userProfile.connectedAccountPage.removeResource.successMessage",{connectedAccount:null===(i=m[u.current])||void 0===i?void 0:i.name}),deleteResource:()=>Promise.resolve(null==d?void 0:d.destroy()),onSuccess:n,onReset:s}):null},K=e=>{var t;let{user:i}=(0,h.aF)(),{walletId:l,onSuccess:n,onReset:s}=e,c=null==i?void 0:i.web3Wallets.find(e=>e.id===l),d=o.useRef(null==c?void 0:c.web3Wallet),u=(null==c?void 0:null===(t=c.verification)||void 0===t?void 0:t.status)==="verified"?(0,a.localizationKeys)("userProfile.web3WalletPage.removeResource.messageLine2"):void 0;return d.current?(0,r.tZ)(p.LE,{title:(0,a.localizationKeys)("userProfile.web3WalletPage.removeResource.title"),messageLine1:(0,a.localizationKeys)("userProfile.web3WalletPage.removeResource.messageLine1",{identifier:d.current}),messageLine2:u,successMessage:(0,a.localizationKeys)("userProfile.web3WalletPage.removeResource.successMessage",{web3Wallet:d.current}),deleteResource:()=>Promise.resolve(null==c?void 0:c.destroy()),onSuccess:n,onReset:s}):null},B=e=>{let{user:t}=(0,h.aF)(),{phoneId:i,onSuccess:l,onReset:n}=e,s=null==t?void 0:t.phoneNumbers.find(e=>e.id===i),c=o.useRef(null==s?void 0:s.phoneNumber);return c.current?(0,r.tZ)(p.LE,{title:(0,a.localizationKeys)("userProfile.mfaPhoneCodePage.removeResource.title"),messageLine1:(0,a.localizationKeys)("userProfile.mfaPhoneCodePage.removeResource.messageLine1",{identifier:c.current}),messageLine2:(0,a.localizationKeys)("userProfile.mfaPhoneCodePage.removeResource.messageLine2"),successMessage:(0,a.localizationKeys)("userProfile.mfaPhoneCodePage.removeResource.successMessage",{mfaPhoneCode:c.current}),deleteResource:()=>Promise.resolve(null==s?void 0:s.setReservedForSecondFactor({reserved:!1})),onSuccess:l,onReset:n}):null},x=e=>{let{onSuccess:t,onReset:i}=e,{user:o}=(0,h.aF)();return o?(0,r.tZ)(p.LE,{title:(0,a.localizationKeys)("userProfile.mfaTOTPPage.removeResource.title"),messageLine1:(0,a.localizationKeys)("userProfile.mfaTOTPPage.removeResource.messageLine1"),messageLine2:(0,a.localizationKeys)("userProfile.mfaTOTPPage.removeResource.messageLine2"),successMessage:(0,a.localizationKeys)("userProfile.mfaTOTPPage.removeResource.successMessage"),deleteResource:o.disableTOTP,onSuccess:t,onReset:i}):null},R=e=>{let{onSuccess:t,onReset:i,passkey:o}=e;return(0,r.tZ)(p.LE,{title:(0,a.localizationKeys)("userProfile.passkeyScreen.removeResource.title"),messageLine1:(0,a.localizationKeys)("userProfile.passkeyScreen.removeResource.messageLine1",{name:o.name}),deleteResource:o.delete,onSuccess:t,onReset:i})},_=e=>{let{close:t}=(0,P.XC)();return(0,r.tZ)(z,{onSuccess:t,onReset:t,...e})},w=["external_account_missing_refresh_token","oauth_fetch_user_error","oauth_token_exchange_error","external_account_email_address_verification_required"],F=(0,n.withCardStateProvider)(e=>{var t;let{shouldAllowCreation:i=!0}=e,{user:o}=(0,h.aF)(),l=(0,n.useCardState)(),s=!!(null==o?void 0:null===(t=o.externalAccounts)||void 0===t?void 0:t.length);if(!o||!i&&!s)return null;let c=[...o.verifiedExternalAccounts,...o.unverifiedExternalAccounts.filter(e=>{var t;return null===(t=e.verification)||void 0===t?void 0:t.error})];return(0,r.BX)(n.ProfileSection.Root,{title:(0,a.localizationKeys)("userProfile.start.connectedAccountsSection.title"),centered:!1,id:"connectedAccounts",children:[(0,r.tZ)(n.Card.Alert,{children:l.error}),(0,r.BX)(v.a.Root,{children:[(0,r.tZ)(n.ProfileSection.ItemList,{id:"connectedAccounts",children:c.map(e=>(0,r.tZ)(T,{account:e},e.id))}),i&&(0,r.tZ)(b,{})]})]})}),T=e=>{var t,i,o,c,d,u;let{account:m}=e,{additionalOAuthScopes:P,componentName:Z,mode:b}=(0,l.useUserProfileContext)(),{navigate:S}=(0,s.useRouter)(),{user:C}=(0,h.aF)(),z=(0,n.useCardState)(),K="modal"===b,B=K?(0,f.bX)({url:window.location.href,componentName:Z}):window.location.href,[x]=(0,h.jJ)(()=>C?C.createExternalAccount({strategy:m.verification.strategy,redirectUrl:B,additionalScopes:k}):Promise.resolve(void 0));if(!C)return null;let{providerToDisplayData:R}=(0,g.vO)(),F=m.username||m.emailAddress,T=null===(i=m.verification)||void 0===i?void 0:null===(t=i.error)||void 0===t?void 0:t.longMessage,k=function(e,t){if(!t)return[];let i=t[e.provider]||[],r=e.approvedScopes.split(" ");return 0===i.filter(e=>!r.includes(e)).length?[]:i}(m,P),A=k.length>0&&""!=m.approvedScopes,X=w.includes((null===(c=m.verification)||void 0===c?void 0:null===(o=c.error)||void 0===o?void 0:o.code)||"")||A,L=X?(0,a.localizationKeys)("userProfile.start.connectedAccountsSection.subtitle__disconnected"):T,D=async()=>{let e=K?(0,f.bX)({url:window.location.href,componentName:Z}):window.location.href;try{let i;if(i=A?await m.reauthorize({additionalScopes:k,redirectUrl:e}):await x()){var t;await S((null===(t=i.verification.externalVerificationRedirectURL)||void 0===t?void 0:t.href)||"")}}catch(e){(0,y.S3)(e,[],z.setError)}};return(0,r.BX)(v.a.Root,{children:[(0,r.BX)(n.ProfileSection.Item,{id:"connectedAccounts",children:[(0,r.BX)(a.Flex,{sx:e=>({overflow:"hidden",gap:e.space.$2}),children:[(0,r.tZ)(()=>R[m.provider].iconUrl?(0,r.tZ)(a.Image,{elementDescriptor:[a.descriptors.providerIcon],elementId:a.descriptors.socialButtonsProviderIcon.setId(m.provider),alt:R[m.provider].name,src:R[m.provider].iconUrl,sx:e=>({width:e.sizes.$4,flexShrink:0})}):(0,r.tZ)(p.e_,{id:m.provider,value:R[m.provider].name}),{}),(0,r.tZ)(a.Box,{sx:{whiteSpace:"nowrap",overflow:"hidden"},children:(0,r.BX)(a.Flex,{gap:2,center:!0,children:[(0,r.tZ)(a.Text,{sx:e=>({color:e.colors.$colorText}),children:"".concat(R[m.provider].name)}),(0,r.tZ)(a.Text,{truncate:!0,as:"span",colorScheme:"secondary",children:F?"• ".concat(F):""})]})})]}),(0,r.tZ)(I,{})]}),X&&(0,r.BX)(a.Box,{sx:e=>({padding:"".concat(e.sizes.$none," ").concat(e.sizes.$none," ").concat(e.sizes.$1x5," ").concat(e.sizes.$8x5)}),children:[(0,r.tZ)(a.Text,{colorScheme:"secondary",sx:e=>({paddingRight:e.sizes.$1x5,display:"inline-block"}),localizationKey:L}),(0,r.tZ)(a.Button,{sx:{display:"inline-block"},onClick:D,variant:"link",localizationKey:(0,a.localizationKeys)("userProfile.start.connectedAccountsSection.actionLabel__connectionFailed")})]}),(null===(u=m.verification)||void 0===u?void 0:null===(d=u.error)||void 0===d?void 0:d.code)&&!X&&(0,r.tZ)(a.Text,{colorScheme:"danger",sx:e=>({padding:"".concat(e.sizes.$none," ").concat(e.sizes.$1x5," ").concat(e.sizes.$1x5," ").concat(e.sizes.$8x5)}),children:T}),(0,r.tZ)(v.a.Open,{value:"remove",children:(0,r.tZ)(v.a.Card,{variant:"destructive",children:(0,r.tZ)(_,{accountId:m.id})})})]},m.id)},I=()=>{let{open:e}=(0,P.XC)(),t=[{label:(0,a.localizationKeys)("userProfile.start.connectedAccountsSection.destructiveActionTitle"),isDestructive:!0,onClick:()=>e("remove")}].filter(e=>null!==e);return(0,r.tZ)(n.ThreeDotsMenu,{actions:t})},k=e=>t=>t.id===e?-1:1,A=e=>e.defaultSecondFactor?-1:1;function X(e){let t=[];return Object.entries(e).forEach(e=>{let[,i]=e;i.used_for_second_factor&&t.push(...i.second_factors)}),t}function L(e,t){let i=X(e);return t.totpEnabled&&(i=i.filter(e=>"totp"!==e)),(t.backupCodeEnabled||!t.twoFactorEnabled)&&(i=i.filter(e=>"backup_code"!==e)),i}function D(e,t){if(!e)return[];let i=e.filter(e=>e.id===t),r=e.filter(e=>e.id!==t),o=r.filter(e=>{var t;return(null===(t=e.verification)||void 0===t?void 0:t.status)==="verified"}),l=r.filter(e=>{var t,i;return!!(null===(t=e.verification)||void 0===t?void 0:t.status)&&(null===(i=e.verification)||void 0===i?void 0:i.status)!=="verified"}),a=r.filter(e=>!e.verification.status);return o.sort((e,t)=>e.id.localeCompare(t.id)),l.sort((e,t)=>{var i,r;return(null===(i=e.verification)||void 0===i?void 0:i.expireAt)&&(null===(r=t.verification)||void 0===r?void 0:r.expireAt)?e.verification.expireAt.getTime()-t.verification.expireAt.getTime():0}),[...i,...o,...l,...a]}let E=e=>{let t=(0,n.useCardState)(),{nextStep:i,identification:l,identifier:s,onReset:c,prepareVerification:d}=e,u=()=>{var e;return null==d?void 0:null===(e=d())||void 0===e?void 0:e.catch(e=>(0,y.S3)(e,[],t.setError))},m=(0,n.useFieldOTP)({onCodeEntryFinished:(e,t,i)=>{null==l||l.attemptVerification({code:e}).then(()=>t()).catch(i)},onResendCodeClicked:u,onResolve:i});return o.useEffect(()=>{u()},[]),(0,r.BX)(r.HY,{children:[(0,r.tZ)(n.Form.OTPInput,{...m,label:(0,a.localizationKeys)("userProfile.emailAddressPage.emailCode.formTitle"),description:(0,a.localizationKeys)("userProfile.emailAddressPage.emailCode.formSubtitle",{identifier:s}),resendButton:(0,a.localizationKeys)("userProfile.emailAddressPage.emailCode.resendButton"),centerAlign:!1}),(0,r.BX)(n.FormButtonContainer,{children:[(0,r.tZ)(a.Button,{isLoading:m.isLoading,localizationKey:(0,a.localizationKeys)("formButtonPrimary__verify"),elementDescriptor:a.descriptors.formButtonPrimary,onClick:m.onFakeContinue}),(0,r.tZ)(a.Button,{variant:"ghost",isDisabled:m.isLoading,localizationKey:(0,a.localizationKeys)("userProfile.formButtonReset"),elementDescriptor:a.descriptors.formButtonReset,onClick:c})]})]})};var O=i("6749");let $=e=>{let{email:t,nextStep:i,onReset:s}=e,c=(0,n.useCardState)(),d=(0,l.useUserProfileContext)(),{startEmailLinkFlow:u}=(0,g.E2)(t),{displayConfig:m}=(0,l.useEnvironment)();function h(){let{routing:e}=d,t="virtual"===e?m.userProfileUrl:"";u({redirectUrl:(0,O.d)(d,t)}).then(()=>i()).catch(e=>(0,y.S3)(e,[],c.setError))}return o.useEffect(()=>{h()},[]),(0,r.BX)(r.HY,{children:[(0,r.tZ)(n.VerificationLink,{resendButton:(0,a.localizationKeys)("userProfile.emailAddressPage.emailLink.resendButton"),onResendCodeClicked:h}),(0,r.tZ)(n.FormButtonContainer,{children:(0,r.tZ)(a.Button,{variant:"ghost",localizationKey:(0,a.localizationKeys)("userProfile.formButtonReset"),elementDescriptor:a.descriptors.formButtonReset,onClick:s})})]})},N=()=>(0,r.tZ)(p.Ej,{title:(0,a.localizationKeys)("signUp.emailLink.verifiedSwitchTab.title"),subtitle:(0,a.localizationKeys)("signUp.emailLink.verifiedSwitchTab.subtitle"),status:"verified"}),M=(0,n.withCardStateProvider)(e=>{var t,i,s;let{emailId:c,onSuccess:d,onReset:u}=e,m=(0,n.useCardState)(),{user:f}=(0,h.aF)(),v=function(e){let{userSettings:t}=e,{email_address:i}=t.attributes;return i.enabled&&i.verifications.includes("email_link")}((0,l.useEnvironment)()),[P]=(0,h.jJ)(()=>f?f.createEmailAddress({email:b.value}):Promise.resolve(void 0)),g=o.useRef(null==f?void 0:f.emailAddresses.find(e=>e.id===c)),Z=(0,p.a2)({defaultStep:g.current?1:0,onNextStep:()=>m.setError(void 0)}),b=(0,y.Yp)("emailAddress","",{type:"email",label:(0,a.localizationKeys)("formFieldLabel__emailAddress"),placeholder:(0,a.localizationKeys)("formFieldInputPlaceholder__emailAddress"),isRequired:!0}),S=b.value.length>1&&(null==f?void 0:f.username)!==b.value,C=async e=>{if(e.preventDefault(),f)return P().then(e=>{g.current=e,Z.nextStep()}).catch(e=>(0,y.S3)(e,[b],m.setError))};return(0,r.BX)(p.en,{...Z.props,children:[(0,r.tZ)(n.FormContainer,{headerTitle:(0,a.localizationKeys)("userProfile.emailAddressPage.title"),headerSubtitle:v?(0,a.localizationKeys)("userProfile.emailAddressPage.emailLink.formHint"):(0,a.localizationKeys)("userProfile.emailAddressPage.emailCode.formHint"),children:(0,r.BX)(n.Form.Root,{onSubmit:C,children:[(0,r.tZ)(n.Form.ControlRow,{elementId:b.id,children:(0,r.tZ)(n.Form.PlainInput,{...b.props,autoFocus:!0})}),(0,r.tZ)(n.FormButtons,{submitLabel:(0,a.localizationKeys)("userProfile.formButtonPrimary__add"),isDisabled:!S,onReset:u})]})}),(0,r.tZ)(n.FormContainer,{headerTitle:(0,a.localizationKeys)("userProfile.emailAddressPage.verifyTitle"),headerSubtitle:v?(0,a.localizationKeys)("userProfile.emailAddressPage.emailLink.formSubtitle",{identifier:null===(t=g.current)||void 0===t?void 0:t.emailAddress}):(0,a.localizationKeys)("userProfile.emailAddressPage.emailCode.formSubtitle",{identifier:null===(i=g.current)||void 0===i?void 0:i.emailAddress}),children:v?(0,r.tZ)($,{nextStep:d,email:g.current,onReset:u}):(0,r.tZ)(E,{nextStep:d,identification:g.current,identifier:null===(s=g.current)||void 0===s?void 0:s.emailAddress,prepareVerification:()=>{var e;return null===(e=g.current)||void 0===e?void 0:e.prepareVerification({strategy:"email_code"})},onReset:u})})]})}),U=e=>{let{close:t}=(0,P.XC)();return(0,r.tZ)(S,{onSuccess:t,onReset:t,...e})},W=e=>{let{close:t}=(0,P.XC)();return(0,r.tZ)(M,{onSuccess:t,onReset:t,...e})},j=e=>{let{shouldAllowCreation:t=!0}=e,{user:i}=(0,h.aF)();return(0,r.tZ)(n.ProfileSection.Root,{title:(0,a.localizationKeys)("userProfile.start.emailAddressesSection.title"),centered:!1,id:"emailAddresses",children:(0,r.tZ)(v.a.Root,{children:(0,r.BX)(n.ProfileSection.ItemList,{id:"emailAddresses",children:[D(null==i?void 0:i.emailAddresses,null==i?void 0:i.primaryEmailAddressId).map(e=>(0,r.BX)(v.a.Root,{children:[(0,r.BX)(n.ProfileSection.Item,{id:"emailAddresses",children:[(0,r.BX)(a.Flex,{sx:e=>({overflow:"hidden",gap:e.space.$1}),children:[(0,r.tZ)(a.Text,{sx:e=>({color:e.colors.$colorText}),truncate:!0,children:e.emailAddress}),(null==i?void 0:i.primaryEmailAddressId)===e.id&&(0,r.tZ)(a.Badge,{localizationKey:(0,a.localizationKeys)("badge__primary")}),"verified"!==e.verification.status&&(0,r.tZ)(a.Badge,{localizationKey:(0,a.localizationKeys)("badge__unverified")})]}),(0,r.tZ)(q,{email:e})]}),(0,r.tZ)(v.a.Open,{value:"remove",children:(0,r.tZ)(v.a.Card,{variant:"destructive",children:(0,r.tZ)(U,{emailId:e.id})})}),(0,r.tZ)(v.a.Open,{value:"verify",children:(0,r.tZ)(v.a.Card,{children:(0,r.tZ)(W,{emailId:e.id})})})]},e.emailAddress)),t&&(0,r.BX)(r.HY,{children:[(0,r.tZ)(v.a.Trigger,{value:"add",children:(0,r.tZ)(n.ProfileSection.ArrowButton,{id:"emailAddresses",localizationKey:(0,a.localizationKeys)("userProfile.start.emailAddressesSection.primaryButton")})}),(0,r.tZ)(v.a.Open,{value:"add",children:(0,r.tZ)(v.a.Card,{children:(0,r.tZ)(W,{})})})]})]})})})},q=e=>{let{email:t}=e,i=(0,n.useCardState)(),{user:o}=(0,h.aF)(),{open:l}=(0,P.XC)(),s=(null==o?void 0:o.primaryEmailAddressId)===t.id,c="verified"===t.verification.status,d=[s&&!c?{label:(0,a.localizationKeys)("userProfile.start.emailAddressesSection.detailsAction__primary"),onClick:()=>l("verify")}:null,!s&&c?{label:(0,a.localizationKeys)("userProfile.start.emailAddressesSection.detailsAction__nonPrimary"),onClick:()=>null==o?void 0:o.update({primaryEmailAddressId:t.id}).catch(e=>(0,y.S3)(e,[],i.setError))}:null,s||c?null:{label:(0,a.localizationKeys)("userProfile.start.emailAddressesSection.detailsAction__unverified"),onClick:()=>l("verify")},{label:(0,a.localizationKeys)("userProfile.start.emailAddressesSection.destructiveAction"),isDestructive:!0,onClick:()=>l("remove")}].filter(e=>null!==e);return(0,r.tZ)(n.ThreeDotsMenu,{actions:d})},Y=()=>{let{user:e}=(0,h.aF)(),{getSamlProviderLogoUrl:t,getSamlProviderName:i}=(0,g.n$)();return(0,r.tZ)(n.ProfileSection.Root,{title:(0,a.localizationKeys)("userProfile.start.enterpriseAccountsSection.title"),id:"enterpriseAccounts",centered:!1,children:(0,r.tZ)(n.ProfileSection.ItemList,{id:"enterpriseAccounts",children:null==e?void 0:e.samlAccounts.map(e=>{var o,l;let s=e.emailAddress,c=i(e.provider),d=t(e.provider),u=null===(l=e.verification)||void 0===l?void 0:null===(o=l.error)||void 0===o?void 0:o.longMessage;return(0,r.BX)(n.ProfileSection.Item,{id:"enterpriseAccounts",sx:e=>({gap:e.space.$2,justifyContent:"start"}),children:[(0,r.tZ)(a.Image,{elementDescriptor:[a.descriptors.providerIcon],elementId:a.descriptors.enterpriseButtonsProviderIcon.setId(e.provider),alt:c,src:d,sx:e=>({width:e.sizes.$4})}),(0,r.tZ)(a.Box,{sx:{whiteSpace:"nowrap",overflow:"hidden"},children:(0,r.BX)(a.Flex,{gap:2,center:!0,children:[(0,r.tZ)(a.Text,{truncate:!0,colorScheme:"body",children:c}),(0,r.tZ)(a.Text,{truncate:!0,as:"span",colorScheme:"secondary",children:s?"• ".concat(s):""}),u&&(0,r.tZ)(a.Badge,{colorScheme:"danger",localizationKey:(0,a.localizationKeys)("badge__requiresAction")})]})})]},e.id)})})})},H=(0,n.withCardStateProvider)(e=>{let{phoneId:t,onSuccess:i,onReset:l}=e,{user:n}=(0,h.aF)(),s=o.useRef(null==n?void 0:n.phoneNumbers.find(e=>e.id===t)),c=(0,p.a2)({defaultStep:s.current?1:0});return(0,r.BX)(p.en,{...c.props,children:[(0,r.tZ)(V,{resourceRef:s,title:(0,a.localizationKeys)("userProfile.phoneNumberPage.title"),onSuccess:c.nextStep,onReset:l}),(0,r.tZ)(J,{resourceRef:s,title:(0,a.localizationKeys)("userProfile.phoneNumberPage.verifyTitle"),onSuccess:i,onReset:l})]})}),V=e=>{var t;let{title:i,onSuccess:o,onReset:l,onUseExistingNumberClick:s,resourceRef:c}=e,d=(0,n.useCardState)(),{user:u}=(0,h.aF)(),[m]=(0,h.jJ)(()=>u?u.createPhoneNumber({phoneNumber:f.value}):Promise.resolve(void 0)),f=(0,y.Yp)("phoneNumber","",{type:"tel",label:(0,a.localizationKeys)("formFieldLabel__phoneNumber"),isRequired:!0}),p=f.value.length>1&&(null==u?void 0:u.username)!==f.value,v=!!(null==u?void 0:null===(t=u.phoneNumbers)||void 0===t?void 0:t.length)&&s,P=async e=>{if(e.preventDefault(),u)return m().then(e=>{c.current=e,o()}).catch(e=>(0,y.S3)(e,[f],d.setError))};return(0,r.tZ)(n.FormContainer,{headerTitle:i,gap:1,children:(0,r.BX)(n.Form.Root,{gap:4,onSubmit:P,children:[(0,r.tZ)(a.Text,{localizationKey:(0,a.localizationKeys)("userProfile.phoneNumberPage.infoText"),colorScheme:"secondary"}),(0,r.tZ)(n.Form.ControlRow,{elementId:f.id,children:(0,r.tZ)(n.Form.PhoneInput,{...f.props,autoFocus:!0})}),(0,r.BX)(a.Flex,{justify:v?"between":"end",children:[v&&(0,r.tZ)(a.Button,{variant:"ghost",localizationKey:(0,a.localizationKeys)("userProfile.mfaPhoneCodePage.backButton"),onClick:s}),(0,r.tZ)(n.FormButtons,{submitLabel:(0,a.localizationKeys)("userProfile.formButtonPrimary__add"),isDisabled:!p,onReset:l})]})]})})},J=e=>{var t,i,o;let{title:l,onSuccess:s,resourceRef:c,onReset:d}=e;return(0,r.tZ)(n.FormContainer,{headerTitle:l,headerSubtitle:(0,a.localizationKeys)("userProfile.phoneNumberPage.verifySubtitle",{identifier:null===(t=c.current)||void 0===t?void 0:t.phoneNumber}),children:(0,r.tZ)(E,{nextStep:s,identification:c.current,identifier:null===(i=c.current)||void 0===i?void 0:i.phoneNumber,prepareVerification:null===(o=c.current)||void 0===o?void 0:o.prepareVerification,onReset:d})})},Q=e=>{let{close:t}=(0,P.XC)();return(0,r.tZ)(C,{onSuccess:t,onReset:t,...e})},G=e=>{let{close:t}=(0,P.XC)();return(0,r.tZ)(H,{onSuccess:t,onReset:t,...e})},ee=e=>{var t;let{shouldAllowCreation:i=!0}=e,{user:o}=(0,h.aF)(),l=!!(null==o?void 0:null===(t=o.phoneNumbers)||void 0===t?void 0:t.length);return i||l?(0,r.tZ)(n.ProfileSection.Root,{centered:!1,title:(0,a.localizationKeys)("userProfile.start.phoneNumbersSection.title"),id:"phoneNumbers",children:(0,r.tZ)(v.a.Root,{children:(0,r.BX)(n.ProfileSection.ItemList,{id:"phoneNumbers",children:[D(null==o?void 0:o.phoneNumbers,null==o?void 0:o.primaryPhoneNumberId).map(e=>(0,r.BX)(v.a.Root,{children:[(0,r.tZ)(v.a.Closed,{value:"",children:(0,r.BX)(n.ProfileSection.Item,{id:"phoneNumbers",children:[(0,r.tZ)(a.Box,{sx:{whiteSpace:"nowrap",overflow:"hidden"},children:(0,r.BX)(a.Flex,{gap:2,center:!0,children:[(0,r.tZ)(a.Text,{sx:e=>({color:e.colors.$colorText}),children:(0,y.L_)(e.phoneNumber)}),(null==o?void 0:o.primaryPhoneNumberId)===e.id&&(0,r.tZ)(a.Badge,{localizationKey:(0,a.localizationKeys)("badge__primary")}),"verified"!==e.verification.status&&(0,r.tZ)(a.Badge,{localizationKey:(0,a.localizationKeys)("badge__unverified")})]})}),(0,r.tZ)(et,{phone:e})]})}),(0,r.tZ)(v.a.Open,{value:"remove",children:(0,r.tZ)(v.a.Card,{variant:"destructive",children:(0,r.tZ)(Q,{phoneId:e.id})})}),(0,r.tZ)(v.a.Open,{value:"verify",children:(0,r.tZ)(v.a.Card,{children:(0,r.tZ)(G,{phoneId:e.id})})})]},e.id)),i&&(0,r.BX)(r.HY,{children:[(0,r.tZ)(v.a.Trigger,{value:"add",children:(0,r.tZ)(n.ProfileSection.ArrowButton,{id:"phoneNumbers",localizationKey:(0,a.localizationKeys)("userProfile.start.phoneNumbersSection.primaryButton")})}),(0,r.tZ)(v.a.Open,{value:"add",children:(0,r.tZ)(v.a.Card,{children:(0,r.tZ)(G,{})})})]})]})})}):null},et=e=>{let{phone:t}=e,i=(0,n.useCardState)(),{open:o}=(0,P.XC)(),{user:l}=(0,h.aF)();if(!l)return null;let s=l.primaryPhoneNumberId===t.id,c="verified"===t.verification.status,d=[s&&!c?{label:(0,a.localizationKeys)("userProfile.start.phoneNumbersSection.detailsAction__primary"),onClick:()=>o("verify")}:null,!s&&c?{label:(0,a.localizationKeys)("userProfile.start.phoneNumbersSection.detailsAction__nonPrimary"),onClick:()=>l.update({primaryPhoneNumberId:t.id}).catch(e=>(0,y.S3)(e,[],i.setError))}:null,s||c?null:{label:(0,a.localizationKeys)("userProfile.start.phoneNumbersSection.detailsAction__unverified"),onClick:()=>o("verify")},{label:(0,a.localizationKeys)("userProfile.start.phoneNumbersSection.destructiveAction"),isDestructive:!0,onClick:()=>o("remove")}].filter(e=>null!==e);return(0,r.tZ)(n.ThreeDotsMenu,{actions:d})};var ei=i("5295");let er=(0,n.withCardStateProvider)(e=>{let{onSuccess:t,onReset:i}=e,{user:o}=(0,h.aF)(),[s]=(0,h.jJ)(()=>o?o.update({username:u.value}):Promise.resolve(void 0)),{userSettings:c}=(0,l.useEnvironment)(),d=(0,n.useCardState)(),u=(0,y.Yp)("username",(null==o?void 0:o.username)||"",{type:"text",label:(0,a.localizationKeys)("formFieldLabel__username"),placeholder:(0,a.localizationKeys)("formFieldInputPlaceholder__username")});if(!o)return null;let m=c.attributes.username.required,f=(!m||u.value.length>0)&&o.username!==u.value,p=async()=>{try{await s(),t()}catch(e){(0,y.S3)(e,[u],d.setError)}};return(0,r.tZ)(n.FormContainer,{headerTitle:o.username?(0,a.localizationKeys)("userProfile.usernamePage.title__update"):(0,a.localizationKeys)("userProfile.usernamePage.title__set"),children:(0,r.BX)(n.Form.Root,{onSubmit:p,children:[(0,r.tZ)(n.Form.ControlRow,{elementId:u.id,children:(0,r.tZ)(n.Form.PlainInput,{...u.props,autoFocus:!0,isRequired:m})}),(0,r.tZ)(n.FormButtons,{isDisabled:!f,onReset:i})]})})}),eo=()=>{let{close:e}=(0,P.XC)();return(0,r.tZ)(er,{onSuccess:e,onReset:e})},el=()=>{let{user:e}=(0,h.aF)();return e?(0,r.tZ)(n.ProfileSection.Root,{title:(0,a.localizationKeys)("userProfile.start.usernameSection.title"),id:"username",sx:{alignItems:"center",[ei.mqu.md]:{alignItems:"flex-start"}},children:(0,r.BX)(v.a.Root,{children:[(0,r.tZ)(v.a.Closed,{value:"edit",children:(0,r.BX)(n.ProfileSection.Item,{id:"username",sx:{paddingLeft:e.username?void 0:"0"},children:[e.username&&(0,r.tZ)(a.Text,{truncate:!0,sx:e=>({color:e.colors.$colorText}),children:e.username}),(0,r.tZ)(v.a.Trigger,{value:"edit",children:(0,r.tZ)(n.ProfileSection.Button,{id:"username",localizationKey:e.username?(0,a.localizationKeys)("userProfile.start.usernameSection.primaryButton__updateUsername"):(0,a.localizationKeys)("userProfile.start.usernameSection.primaryButton__setUsername")})})]})}),(0,r.tZ)(v.a.Open,{value:"edit",children:(0,r.tZ)(v.a.Card,{children:(0,r.tZ)(eo,{})})})]})}):null},ea=e=>{let{user:t,...i}=e;return(0,r.tZ)(n.AvatarUploader,{...i,title:(0,c.u1)("userProfile.profilePage.imageFormTitle"),avatarPreview:(0,r.tZ)(n.UserAvatar,{size:e=>e.sizes.$12,...t})})},en=(0,n.withCardStateProvider)(e=>{let{onSuccess:t,onReset:i}=e,o=(0,n.useCardState)(),{user:s}=(0,h.aF)();if(!s)return null;let{first_name:c,last_name:d}=(0,l.useEnvironment)().userSettings.attributes,u=c.enabled,m=d.enabled,p=s.firstName||"",v=s.lastName||"",P=(0,y.Yp)("firstName",s.firstName||"",{type:"text",label:(0,a.localizationKeys)("formFieldLabel__firstName"),placeholder:(0,a.localizationKeys)("formFieldInputPlaceholder__firstName"),isRequired:d.required}),g=(0,y.Yp)("lastName",s.lastName||"",{type:"text",label:(0,a.localizationKeys)("formFieldLabel__lastName"),placeholder:(0,a.localizationKeys)("formFieldInputPlaceholder__lastName"),isRequired:d.required}),Z=u&&P.value!==p||m&&g.value!==v,b=u&&c.required||m&&d.required,S=b&&!!g.value&&!!P.value&&Z,C=s.samlAccounts.some(e=>e.active),z=async e=>(e.preventDefault(),(Z?s.update({firstName:P.value,lastName:g.value}):Promise.resolve()).then(t).catch(e=>{(0,y.S3)(e,[P,g],o.setError)}));return(0,r.BX)(n.FormContainer,{headerTitle:(0,a.localizationKeys)("userProfile.profilePage.title"),children:[C&&(0,r.tZ)(n.InformationBox,{message:(0,a.localizationKeys)("userProfile.profilePage.readonly")}),(0,r.BX)(n.Form.Root,{onSubmit:z,sx:e=>({gap:e.space.$6}),children:[(0,r.tZ)(ea,{user:s,onAvatarChange:e=>s.setProfileImage({file:e}).then(()=>{o.setIdle()}).catch(e=>(0,y.S3)(e,[],o.setError)),onAvatarRemove:(0,f.QO)(s.imageUrl)?null:()=>{s.setProfileImage({file:null}).then(()=>{o.setIdle()}).catch(e=>(0,y.S3)(e,[],o.setError))}}),(u||m)&&(0,r.BX)(n.Form.ControlRow,{elementId:"name",children:[u&&(0,r.tZ)(n.Form.PlainInput,{...P.props,isDisabled:C,autoFocus:!0}),m&&(0,r.tZ)(n.Form.PlainInput,{...g.props,isDisabled:C,autoFocus:!u})]}),(0,r.tZ)(n.FormButtons,{isDisabled:b?!S:!Z,onReset:i})]})]})}),es=()=>{let{close:e}=(0,P.XC)();return(0,r.tZ)(en,{onSuccess:e,onReset:e})},ec=()=>{let{user:e}=(0,h.aF)();if(!e)return null;let{username:t,primaryEmailAddress:i,primaryPhoneNumber:o,...l}=e;return(0,r.tZ)(n.ProfileSection.Root,{title:(0,a.localizationKeys)("userProfile.start.profileSection.title"),id:"profile",sx:{[ei.mqu.md]:{alignItems:"flex-start"}},children:(0,r.BX)(v.a.Root,{children:[(0,r.tZ)(v.a.Closed,{value:"edit",children:(0,r.BX)(n.ProfileSection.Item,{id:"profile",children:[(0,r.tZ)(n.UserPreview,{user:l,size:"lg",mainIdentifierVariant:"subtitle",sx:e=>({color:e.colors.$colorText})}),(0,r.tZ)(v.a.Trigger,{value:"edit",children:(0,r.tZ)(n.ProfileSection.Button,{id:"profile",localizationKey:(0,a.localizationKeys)("userProfile.start.profileSection.primaryButton")})})]})}),(0,r.tZ)(v.a.Open,{value:"edit",children:(0,r.tZ)(v.a.Card,{children:(0,r.tZ)(es,{})})})]})})};var ed=i("6431");let eu=(0,n.withCardStateProvider)(()=>{let e=(0,n.useCardState)(),{user:t}=(0,h.aF)(),{strategies:i,strategyToDisplayData:o}=(0,g.vO)(),l=i.filter(e=>e.startsWith("web3")),s=null==t?void 0:t.verifiedWeb3Wallets.map(e=>e.verification.strategy),c=l.filter(e=>!s.includes(e)),d=async i=>{let r=i.replace("web3_","").replace("_signature","");e.setError(void 0);try{e.setLoading(i);let o=await (0,ed.Ly)({provider:r});if(!t)throw Error("user is not defined");let l=await t.createWeb3Wallet({web3Wallet:o}),a=(l=await l.prepareVerification({strategy:i})).verification.message,n=await (0,ed.bQ)({identifier:o,nonce:a,provider:r});await l.attemptVerification({signature:n}),e.setIdle()}catch(i){e.setIdle();let t=(0,y.zQ)(i);t?e.setError(t.longMessage):(0,y.S3)(i,[],e.setError)}};return 0===c.length?null:(0,r.BX)(r.HY,{children:[(0,r.tZ)(n.ProfileSection.ActionMenu,{id:"web3Wallets",triggerLocalizationKey:(0,a.localizationKeys)("userProfile.start.web3WalletsSection.primaryButton"),children:c.map(t=>(0,r.tZ)(n.ProfileSection.ActionMenuItem,{id:o[t].id,onClick:()=>d(t),isLoading:e.loadingMetadata===t,isDisabled:e.isLoading,localizationKey:(0,a.localizationKeys)("userProfile.web3WalletPage.web3WalletButtonsBlockButton",{provider:o[t].name}),sx:e=>({justifyContent:"start",gap:e.space.$2}),leftIcon:(0,r.tZ)(a.Image,{elementDescriptor:a.descriptors.providerIcon,elementId:a.descriptors.providerIcon.setId(o[t].id),isLoading:e.loadingMetadata===t,isDisabled:e.isLoading,src:o[t].iconUrl,alt:"Connect ".concat(o[t].name),sx:e=>({width:e.sizes.$5})})},t))}),e.error&&(0,r.tZ)(a.Text,{colorScheme:"danger",sx:e=>({padding:e.sizes.$1x5,paddingLeft:e.sizes.$8x5}),children:e.error})]})}),em=e=>{let{close:t}=(0,P.XC)();return(0,r.tZ)(K,{onSuccess:t,onReset:t,...e})},eh=e=>e.length<=10?e:e.slice(0,6)+"..."+e.slice(-4),ef=(0,n.withCardStateProvider)(e=>{var t;let{shouldAllowCreation:i=!0}=e,{user:o}=(0,h.aF)(),l=(0,n.useCardState)(),{strategyToDisplayData:s}=(0,g.vO)(),c=!!(null==o?void 0:null===(t=o.web3Wallets)||void 0===t?void 0:t.length);return i||c?(0,r.BX)(n.ProfileSection.Root,{title:(0,a.localizationKeys)("userProfile.start.web3WalletsSection.title"),id:"web3Wallets",children:[(0,r.tZ)(n.Card.Alert,{children:l.error}),(0,r.BX)(v.a.Root,{children:[(0,r.tZ)(n.ProfileSection.ItemList,{id:"web3Wallets",children:null==o?void 0:o.web3Wallets.map(e=>{let t=e.verification.strategy;return s[t]&&(0,r.BX)(v.a.Root,{children:[(0,r.tZ)(v.a.Closed,{value:"",children:(0,r.BX)(n.ProfileSection.Item,{id:"web3Wallets",align:"start",children:[(0,r.BX)(a.Flex,{sx:e=>({alignItems:"center",gap:e.space.$2,width:"100%"}),children:[s[t].iconUrl&&(0,r.tZ)(a.Image,{src:s[t].iconUrl,alt:s[t].name,sx:e=>({width:e.sizes.$4})}),(0,r.tZ)(a.Box,{sx:{whiteSpace:"nowrap",overflow:"hidden"},children:(0,r.BX)(a.Flex,{gap:2,justify:"start",children:[(0,r.BX)(a.Text,{children:[s[t].name," (",eh(e.web3Wallet),")"]}),(null==o?void 0:o.primaryWeb3WalletId)===e.id&&(0,r.tZ)(a.Badge,{localizationKey:(0,a.localizationKeys)("badge__primary")}),"verified"!==e.verification.status&&(0,r.tZ)(a.Badge,{localizationKey:(0,a.localizationKeys)("badge__unverified")})]})})]}),(0,r.tZ)(ep,{})]},e.id)}),(0,r.tZ)(v.a.Open,{value:"remove",children:(0,r.tZ)(v.a.Card,{variant:"destructive",children:(0,r.tZ)(em,{walletId:e.id})})})]},e.id)})}),i&&(0,r.tZ)(eu,{})]})]}):null}),ep=()=>{let{open:e}=(0,P.XC)(),t=[{label:(0,a.localizationKeys)("userProfile.start.web3WalletsSection.destructiveAction"),onClick:()=>e("remove")}].filter(e=>null!==e);return(0,r.tZ)(n.ThreeDotsMenu,{actions:t})},ev=(0,n.withCardStateProvider)(()=>{var e;let{attributes:t,saml:i,social:o}=(0,l.useEnvironment)().userSettings,s=(0,n.useCardState)(),{user:c}=(0,h.aF)(),d=t.username.enabled,u=t.email_address.enabled,m=t.phone_number.enabled,f=o&&Object.values(o).filter(e=>e.enabled).length>0,p=i&&i.enabled&&c&&c.samlAccounts.length>0,v=t.web3_wallet.enabled,P=!p||!(null==c?void 0:null===(e=c.samlAccounts)||void 0===e?void 0:e.some(e=>{var t;return e.active&&(null===(t=e.samlConnection)||void 0===t?void 0:t.disableAdditionalIdentifications)}));return(0,r.tZ)(a.Col,{elementDescriptor:a.descriptors.page,sx:e=>({gap:e.space.$8,color:e.colors.$colorText}),children:(0,r.BX)(a.Col,{elementDescriptor:a.descriptors.profilePage,elementId:a.descriptors.profilePage.setId("account"),children:[(0,r.tZ)(n.Header.Root,{children:(0,r.tZ)(n.Header.Title,{localizationKey:(0,a.localizationKeys)("userProfile.start.headerTitle__account"),sx:e=>({marginBottom:e.space.$4}),textVariant:"h2"})}),(0,r.tZ)(n.Card.Alert,{children:s.error}),(0,r.tZ)(ec,{}),d&&(0,r.tZ)(el,{}),u&&(0,r.tZ)(j,{shouldAllowCreation:P}),m&&(0,r.tZ)(ee,{shouldAllowCreation:P}),f&&(0,r.tZ)(F,{shouldAllowCreation:P}),p&&(0,r.tZ)(Y,{}),v&&(0,r.tZ)(ef,{shouldAllowCreation:P})]})})});var eP=i("8655");let eg=()=>{let{user:e}=(0,h.aF)(),{session:t}=(0,h.kP)(),{data:i,isLoading:o}=(0,g.ib)(null==e?void 0:e.getSessions,"user-sessions");return(0,r.tZ)(n.ProfileSection.Root,{title:(0,a.localizationKeys)("userProfile.start.activeDevicesSection.title"),centered:!1,id:"activeDevices",children:(0,r.tZ)(n.ProfileSection.ItemList,{id:"activeDevices",disableAnimation:!0,children:o?(0,r.tZ)(n.FullHeightLoader,{}):null==i?void 0:i.sort(k(t.id)).map(e=>"active"!==e.status?null:(0,r.tZ)(ey,{session:e},e.id))})})},ey=e=>{var t;let{session:i}=e,o=(null===(t=(0,h.kP)().session)||void 0===t?void 0:t.id)===i.id,l=(0,g._m)(),[s]=(0,h.jJ)(i.revoke),c=async()=>{if(!o&&i)return l.setLoading(),s().catch(()=>{}).finally(()=>l.setIdle())};return(0,r.BX)(n.ProfileSection.Item,{id:"activeDevices",elementDescriptor:a.descriptors.activeDeviceListItem,elementId:o?a.descriptors.activeDeviceListItem.setId("current"):void 0,sx:{alignItems:"flex-start"},children:[l.isLoading&&(0,r.tZ)(n.FullHeightLoader,{}),!l.isLoading&&(0,r.BX)(r.HY,{children:[(0,r.tZ)(eZ,{session:i}),!o&&(0,r.tZ)(eb,{revoke:c})]})]})},eZ=e=>{let{session:t}=(0,h.kP)(),i=(null==t?void 0:t.id)===e.session.id,o=!!(null==t?void 0:t.actor),l=!!e.session.actor,{city:n,country:s,browserName:c,browserVersion:d,deviceType:u,ipAddress:m,isMobile:f}=e.session.latestActivity,p="".concat(c||""," ").concat(d||"").trim()||"Web browser",v=[n||"",s||""].filter(Boolean).join(", ").trim()||null,{t:P}=(0,a.useLocalizations)();return(0,r.BX)(a.Flex,{elementDescriptor:a.descriptors.activeDevice,elementId:i?a.descriptors.activeDevice.setId("current"):void 0,sx:e=>({width:"100%",overflow:"hidden",gap:e.space.$4,[ei.mqu.sm]:{gap:e.space.$2}}),children:[(0,r.tZ)(a.Flex,{sx:e=>({[ei.mqu.sm]:{padding:"0"},borderRadius:e.radii.$md}),children:(0,r.tZ)(a.Icon,{elementDescriptor:a.descriptors.activeDeviceIcon,elementId:a.descriptors.activeDeviceIcon.setId(f?"mobile":"desktop"),icon:f?eP.Fh:eP.eu,sx:e=>({"--cl-chassis-bottom":"#444444","--cl-chassis-back":"#343434","--cl-chassis-screen":"#575757","--cl-screen":"#000000",width:e.space.$8,height:e.space.$8})})}),(0,r.BX)(a.Col,{align:"start",gap:1,children:[(0,r.BX)(a.Flex,{center:!0,gap:2,children:[(0,r.tZ)(a.Text,{children:u||(f?"Mobile device":"Desktop device")}),i&&(0,r.tZ)(a.Badge,{localizationKey:(0,a.localizationKeys)("badge__thisDevice"),colorScheme:o?"danger":"primary"}),o&&!l&&(0,r.tZ)(a.Badge,{localizationKey:(0,a.localizationKeys)("badge__userDevice")}),!i&&l&&(0,r.tZ)(a.Badge,{localizationKey:(0,a.localizationKeys)("badge__otherImpersonatorDevice"),colorScheme:"danger"})]}),(0,r.tZ)(a.Text,{colorScheme:"secondary",children:p}),(0,r.BX)(a.Text,{colorScheme:"secondary",children:[m," (",v,")"]}),(0,r.tZ)(a.Text,{colorScheme:"secondary",children:P((0,y.Qg)(e.session.lastActiveAt))})]})]})},eb=e=>{let{revoke:t}=e,i=[{label:(0,a.localizationKeys)("userProfile.start.activeDevicesSection.destructiveAction"),isDestructive:!0,onClick:t}].filter(e=>null!==e);return(0,r.tZ)(n.ThreeDotsMenu,{actions:i})};var eS=i("4264");let eC=(0,n.withCardStateProvider)(e=>{let{onReset:t}=e,i=(0,n.useCardState)(),{afterSignOutUrl:o,afterMultiSessionSingleSignOutUrl:s}=(0,l.useSignOutContext)(),{user:c}=(0,h.aF)(),{t:d}=(0,a.useLocalizations)(),{otherSessions:u}=(0,eS.j)({user:c}),{setActive:m}=(0,h.cL)(),[f]=(0,h.jJ)(()=>c?c.delete():Promise.resolve(void 0)),p=(0,y.Yp)("deleteConfirmation","",{type:"text",label:(0,a.localizationKeys)("userProfile.deletePage.actionDescription"),isRequired:!0,placeholder:(0,a.localizationKeys)("formFieldInputPlaceholder__confirmDeletionUserAccount")}),v=p.value===(d((0,a.localizationKeys)("formFieldInputPlaceholder__confirmDeletionUserAccount"))||"Delete account"),P=async()=>{if(v)try{await f();let e=0===u.length?o:s;return await m({session:null,redirectUrl:e})}catch(e){(0,y.S3)(e,[],i.setError)}};return(0,r.tZ)(n.FormContainer,{headerTitle:(0,a.localizationKeys)("userProfile.deletePage.title"),sx:e=>({gap:e.space.$0x5}),children:(0,r.BX)(n.Form.Root,{onSubmit:P,children:[(0,r.BX)(a.Col,{gap:1,children:[(0,r.tZ)(a.Text,{colorScheme:"secondary",localizationKey:(0,a.localizationKeys)("userProfile.deletePage.messageLine1")}),(0,r.tZ)(a.Text,{colorScheme:"danger",localizationKey:(0,a.localizationKeys)("userProfile.deletePage.messageLine2")})]}),(0,r.tZ)(n.Form.ControlRow,{elementId:p.id,children:(0,r.tZ)(n.Form.PlainInput,{...p.props,ignorePasswordManager:!0})}),(0,r.tZ)(n.FormButtons,{submitLabel:(0,a.localizationKeys)("userProfile.deletePage.confirm"),colorScheme:"danger",isDisabled:!v,onReset:t})]})})}),ez=()=>{let{close:e}=(0,P.XC)();return(0,r.tZ)(eC,{onSuccess:e,onReset:e})},eK=()=>(0,r.tZ)(n.ProfileSection.Root,{title:(0,a.localizationKeys)("userProfile.start.dangerSection.title"),id:"danger",sx:{alignItems:"center",[ei.mqu.md]:{alignItems:"flex-start"}},children:(0,r.BX)(v.a.Root,{children:[(0,r.tZ)(v.a.Closed,{value:"delete",children:(0,r.tZ)(n.ProfileSection.Item,{id:"danger",sx:e=>({paddingLeft:e.space.$1}),children:(0,r.tZ)(v.a.Trigger,{value:"delete",children:(0,r.tZ)(n.ProfileSection.Button,{id:"danger",variant:"ghost",colorScheme:"danger",localizationKey:(0,a.localizationKeys)("userProfile.start.dangerSection.deleteAccountButton")})})})}),(0,r.tZ)(v.a.Open,{value:"delete",children:(0,r.tZ)(v.a.Card,{variant:"destructive",children:(0,r.tZ)(ez,{})})})]})});var eB=i("5878");let ex=e=>{let{code:t}=e;return(0,r.tZ)(a.Flex,{center:!0,sx:e=>({padding:"".concat(e.space.$1," ").concat(e.space.$4)}),children:(0,r.tZ)(a.Text,{children:t})})},eR=e=>{let{subtitle:t,backupCodes:i}=e,{applicationName:o}=(0,l.useEnvironment)().displayConfig,{user:n}=(0,h.aF)(),{print:s,printableProps:c}=(0,p.Qz)(),{onCopy:d,hasCopied:u}=(0,g.VP)((null==i?void 0:i.join(","))||"");if(!n)return null;let m=(0,eB.xC)(n);return i?(0,r.BX)(r.HY,{children:[(0,r.BX)(a.Col,{gap:1,children:[(0,r.tZ)(a.Text,{localizationKey:(0,a.localizationKeys)("userProfile.backupCodePage.title__codelist"),variant:"subtitle"}),(0,r.tZ)(a.Text,{localizationKey:t,variant:"caption",colorScheme:"secondary"})]}),(0,r.BX)(a.Box,{sx:e=>({borderWidth:e.borderWidths.$normal,borderStyle:e.borderStyles.$solid,borderColor:e.colors.$neutralAlpha100,borderRadius:e.radii.$lg}),children:[(0,r.tZ)(a.Grid,{gap:2,sx:e=>({gridTemplateColumns:"repeat(2, minmax(".concat(e.sizes.$12,", 1fr))"),padding:"".concat(e.space.$4," ").concat(e.space.$6)}),children:i.map((e,t)=>(0,r.tZ)(ex,{code:e},t))}),(0,r.BX)(a.Grid,{sx:e=>({borderTopWidth:e.borderWidths.$normal,borderTopStyle:e.borderStyles.$solid,borderTopColor:e.colors.$neutralAlpha100,gridTemplateColumns:"repeat(3, minmax(0, 1fr))",">:not([hidden])~:not([hidden])":{borderRightWidth:"0px",borderLeftWidth:"1px",borderStyle:"solid",borderColor:e.colors.$neutralAlpha100},">:first-child":{borderBottomLeftRadius:e.radii.$lg},">:last-child":{borderBottomRightRadius:e.radii.$lg}}),children:[(0,r.tZ)(a.Button,{variant:"ghost",sx:e=>({width:"100%",padding:"".concat(e.space.$2," 0"),borderRadius:0}),onClick:()=>{let e=document.createElement("a"),t=new Blob([function(e,t,i){let r=null==e?void 0:e.join("\n");return"These are your backup codes for ".concat(t," account ").concat(i,".\nStore them securely and keep them secret. Each code can only be used once.\n\n").concat(r)}(i,o,m)],{type:"text/plain"});e.href=URL.createObjectURL(t),e.download="".concat(o,"_backup_codes.txt"),document.body.appendChild(e),e.click()},children:(0,r.tZ)(a.Icon,{icon:eP.UW})}),(0,r.tZ)(a.Button,{variant:"ghost",sx:e=>({width:"100%",padding:"".concat(e.space.$2," 0"),borderRadius:0}),onClick:s,children:(0,r.tZ)(a.Icon,{icon:eP.Kh})}),(0,r.tZ)(a.Button,{variant:"ghost",onClick:d,sx:e=>({width:"100%",padding:"".concat(e.space.$2," 0"),borderRadius:0}),children:(0,r.tZ)(a.Icon,{icon:u?eP.Jr:eP.CK})})]})]}),(0,r.BX)(p.o4,{...c,children:[(0,r.BX)(a.Heading,{children:["Your backup codes for ",o," account ",m,":"]}),(0,r.tZ)(a.Col,{gap:2,children:i.map((e,t)=>(0,r.tZ)(ex,{code:e},t))})]})]}):null},e_=(0,n.withCardStateProvider)(e=>{let{onSuccess:t}=e,{user:i}=(0,h.aF)(),l=(0,n.useCardState)(),[s]=(0,h.jJ)(()=>i?i.createBackupCode():Promise.resolve(void 0)),[c,d]=o.useState(void 0);return(o.useEffect(()=>{!c&&i&&s().then(e=>d(e)).catch(e=>(0,y.S3)(e,[],l.setError))},[]),l.error)?(0,r.tZ)(n.FormContainer,{headerTitle:(0,a.localizationKeys)("userProfile.backupCodePage.title")}):(0,r.tZ)(n.FormContainer,{headerTitle:(0,a.localizationKeys)("userProfile.backupCodePage.title"),children:c?(0,r.BX)(r.HY,{children:[(0,r.tZ)(a.Text,{localizationKey:(0,a.localizationKeys)("userProfile.backupCodePage.successMessage")}),(0,r.tZ)(eR,{subtitle:(0,a.localizationKeys)("userProfile.backupCodePage.subtitle__codelist"),backupCodes:c.codes}),(0,r.tZ)(n.FormButtonContainer,{children:(0,r.tZ)(a.Button,{autoFocus:!0,onClick:t,localizationKey:(0,a.localizationKeys)("userProfile.formButtonPrimary__finish"),elementDescriptor:a.descriptors.formButtonPrimary})})]}):(0,r.tZ)(n.FullHeightLoader,{})})}),ew=(0,n.withCardStateProvider)(e=>{let{onSuccess:t,onReset:i}=e,o=(0,p.a2)();return(0,r.BX)(p.en,{...o.props,children:[(0,r.tZ)(eF,{onContinue:o.nextStep}),(0,r.tZ)(e_,{onSuccess:t,onReset:i})]})}),eF=e=>{let{onContinue:t}=e,{close:i}=(0,P.XC)();return(0,r.BX)(n.FormContainer,{headerTitle:(0,a.localizationKeys)("userProfile.backupCodePage.title"),children:[(0,r.tZ)(a.Text,{localizationKey:(0,a.localizationKeys)("userProfile.backupCodePage.infoText1")}),(0,r.tZ)(a.Text,{localizationKey:(0,a.localizationKeys)("userProfile.backupCodePage.infoText2")}),(0,r.BX)(n.FormButtonContainer,{sx:{marginTop:0},children:[(0,r.tZ)(a.Button,{textVariant:"buttonSmall",onClick:t,localizationKey:(0,a.localizationKeys)("userProfile.formButtonPrimary__finish"),elementDescriptor:a.descriptors.formButtonPrimary}),(0,r.tZ)(a.Button,{variant:"ghost",onClick:i,localizationKey:(0,a.localizationKeys)("userProfile.formButtonReset"),elementDescriptor:a.descriptors.formButtonReset})]})]})},eT=(0,n.withCardStateProvider)(e=>{var t;let{onReset:i,onSuccess:s}=e,c=o.useRef(),d=(0,p.a2)({defaultStep:2}),u=(0,l.useEnvironment)().userSettings.attributes.backup_code.enabled;return(0,r.BX)(p.en,{...d.props,children:[(0,r.tZ)(V,{title:(0,a.localizationKeys)("userProfile.phoneNumberPage.title"),resourceRef:c,onSuccess:d.nextStep,onUseExistingNumberClick:()=>d.goToStep(2),onReset:i}),(0,r.tZ)(J,{title:(0,a.localizationKeys)("userProfile.mfaPhoneCodePage.title"),resourceRef:c,onSuccess:d.nextStep,onReset:()=>d.goToStep(2)}),(0,r.tZ)(ek,{onSuccess:u?d.nextStep:s,onReset:i,onAddPhoneClick:()=>d.goToStep(0),onUnverifiedPhoneClick:e=>{c.current=e,d.goToStep(1)},title:(0,a.localizationKeys)("userProfile.mfaPhoneCodePage.title"),resourceRef:c}),u&&(0,r.tZ)(n.SuccessPage,{title:(0,a.localizationKeys)("userProfile.mfaPhoneCodePage.successTitle"),text:[(0,a.localizationKeys)("userProfile.mfaPhoneCodePage.successMessage1"),(0,a.localizationKeys)("userProfile.mfaPhoneCodePage.successMessage2")],onFinish:i,contents:(0,r.tZ)(eR,{backupCodes:null===(t=c.current)||void 0===t?void 0:t.backupCodes})})]})}),eI=e=>{let{phone:t,onSuccess:i,onUnverifiedPhoneClick:o,resourceRef:l}=e,s=(0,n.useCardState)(),[c]=(0,h.jJ)(()=>t.setReservedForSecondFactor({reserved:!0})),{country:d}=(0,y.Z_)(t.phoneNumber),u=(0,y.L_)(t.phoneNumber),m=async()=>{if("verified"!==t.verification.status)return o(t);s.setLoading(t.id);try{await c(),l.current=t,i()}catch(e){(0,y.S3)(e,[],s.setError)}finally{s.setIdle()}};return(0,r.BX)(a.Button,{variant:"outline",colorScheme:"neutral",sx:{justifyContent:"start"},onClick:m,isLoading:s.loadingMetadata===t.id,isDisabled:s.isLoading,children:[d.iso.toUpperCase()," ",u]},t.id)},ek=e=>{let{onSuccess:t,onReset:i,title:o,onAddPhoneClick:l,onUnverifiedPhoneClick:s,resourceRef:c}=e,{user:d}=(0,h.aF)();if(!d)return null;let u=d.phoneNumbers.filter(e=>!e.reservedForSecondFactor);return(0,r.BX)(n.FormContainer,{headerTitle:o,gap:1,children:[(0,r.tZ)(a.Text,{localizationKey:(0,a.localizationKeys)(u.length?"userProfile.mfaPhoneCodePage.subtitle__availablePhoneNumbers":"userProfile.mfaPhoneCodePage.subtitle__unavailablePhoneNumbers"),colorScheme:"secondary"}),u.length>0&&(0,r.tZ)(a.Col,{gap:2,children:u.map(e=>(0,r.tZ)(eI,{onSuccess:t,phone:e,onUnverifiedPhoneClick:s,resourceRef:c},e.id))}),(0,r.BX)(n.FormButtonContainer,{sx:{flexDirection:"row",justifyContent:"space-between"},children:[(0,r.tZ)(n.IconButton,{variant:"ghost","aria-label":"Add phone number",icon:(0,r.tZ)(a.Icon,{icon:eP.v3,sx:e=>({marginRight:e.space.$2})}),localizationKey:(0,a.localizationKeys)("userProfile.mfaPhoneCodePage.primaryButton__addPhoneNumber"),onClick:l}),(0,r.tZ)(a.Button,{variant:"ghost",localizationKey:(0,a.localizationKeys)("userProfile.formButtonReset"),onClick:i})]})]})};var eA=i("2434");let eX=(0,n.withCardStateProvider)(e=>{let{title:t,onSuccess:i,onReset:l}=e,{user:s}=(0,h.aF)(),c=(0,n.useCardState)(),[d]=(0,h.jJ)(()=>s?s.createTOTP():Promise.resolve(void 0)),{close:u}=(0,P.XC)(),[m,f]=o.useState(void 0),[v,g]=o.useState("qr");return(o.useEffect(()=>{s&&d().then(e=>f(e)).catch(e=>(0,eA.uX)(e)&&"reverification_cancelled"===e.code?u():(0,y.S3)(e,[],c.setError))},[]),c.error)?(0,r.tZ)(n.FormContainer,{headerTitle:t}):(0,r.BX)(n.FormContainer,{headerTitle:t,headerSubtitle:"qr"==v?(0,a.localizationKeys)("userProfile.mfaTOTPPage.authenticatorApp.infoText__ableToScan"):(0,a.localizationKeys)("userProfile.mfaTOTPPage.authenticatorApp.infoText__unableToScan"),children:[!m&&(0,r.tZ)(n.FullHeightLoader,{}),m&&(0,r.BX)(r.HY,{children:[(0,r.BX)(a.Col,{gap:4,children:["qr"==v&&(0,r.tZ)(p.s_,{justify:"center",url:m.uri||""}),"uri"==v&&(0,r.BX)(r.HY,{children:[(0,r.tZ)(a.Text,{colorScheme:"secondary",localizationKey:(0,a.localizationKeys)("userProfile.mfaTOTPPage.authenticatorApp.inputLabel__unableToScan1")}),(0,r.tZ)(n.ClipboardInput,{value:m.secret}),(0,r.tZ)(a.Text,{colorScheme:"secondary",localizationKey:(0,a.localizationKeys)("userProfile.mfaTOTPPage.authenticatorApp.inputLabel__unableToScan2")}),(0,r.tZ)(n.ClipboardInput,{value:m.uri})]})]}),(0,r.BX)(a.Flex,{justify:"between",align:"center",sx:{width:"100%"},children:["qr"==v&&(0,r.tZ)(a.Button,{variant:"link",textVariant:"buttonLarge",onClick:()=>g("uri"),localizationKey:(0,a.localizationKeys)("userProfile.mfaTOTPPage.authenticatorApp.buttonUnableToScan__nonPrimary")}),"uri"==v&&(0,r.tZ)(a.Button,{variant:"link",textVariant:"buttonLarge",onClick:()=>g("qr"),localizationKey:(0,a.localizationKeys)("userProfile.mfaTOTPPage.authenticatorApp.buttonAbleToScan__nonPrimary")}),(0,r.BX)(n.FormButtonContainer,{children:[(0,r.tZ)(a.Button,{onClick:i,localizationKey:(0,a.localizationKeys)("userProfile.formButtonPrimary__continue"),elementDescriptor:a.descriptors.formButtonPrimary}),(0,r.tZ)(a.Button,{variant:"ghost",onClick:l,localizationKey:(0,a.localizationKeys)("userProfile.formButtonReset"),elementDescriptor:a.descriptors.formButtonReset})]})]})]})]})}),eL=(0,n.withCardStateProvider)(e=>{let{onSuccess:t,onReset:i,resourceRef:o}=e,{user:l}=(0,h.aF)(),s=(0,n.useFieldOTP)({onCodeEntryFinished:(e,t,i)=>{null==l||l.verifyTOTP({code:e}).then(e=>t(e)).catch(i)},onResolve:e=>{o.current=e,t()}});return(0,r.BX)(n.FormContainer,{headerTitle:(0,a.localizationKeys)("userProfile.mfaTOTPPage.title"),children:[(0,r.tZ)(a.Col,{children:(0,r.tZ)(n.Form.OTPInput,{...s,label:(0,a.localizationKeys)("userProfile.mfaTOTPPage.verifyTitle"),description:(0,a.localizationKeys)("userProfile.mfaTOTPPage.verifySubtitle")})}),(0,r.tZ)(n.FormButtonContainer,{sx:{marginTop:0},children:(0,r.tZ)(a.Button,{onClick:i,variant:"ghost",isDisabled:s.isLoading,localizationKey:(0,a.localizationKeys)("userProfile.formButtonReset"),elementDescriptor:a.descriptors.formButtonReset})})]})}),eD=(0,n.withCardStateProvider)(e=>{var t;let{onReset:i}=e,l=(0,p.a2)(),s=o.useRef();return(0,r.BX)(p.en,{...l.props,children:[(0,r.tZ)(eX,{title:(0,a.localizationKeys)("userProfile.mfaTOTPPage.title"),onSuccess:l.nextStep,onReset:i}),(0,r.tZ)(eL,{onSuccess:l.nextStep,onReset:i,resourceRef:s}),(0,r.tZ)(n.SuccessPage,{title:(0,a.localizationKeys)("userProfile.mfaTOTPPage.title"),text:(0,a.localizationKeys)("userProfile.mfaTOTPPage.successMessage"),onFinish:i,contents:(0,r.tZ)(eR,{subtitle:(0,a.localizationKeys)("userProfile.backupCodePage.successSubtitle"),backupCodes:null===(t=s.current)||void 0===t?void 0:t.backupCodes})})]})}),eE=(0,n.withCardStateProvider)(e=>{let{onSuccess:t,onReset:i,selectedStrategy:s}=e,c=(0,n.useCardState)(),{userSettings:{attributes:d}}=(0,l.useEnvironment)(),{user:u}=(0,h.aF)();if(!u)return null;let m=(0,a.localizationKeys)("userProfile.mfaPage.title"),f=o.useMemo(()=>L(d,u),[]);return(o.useEffect(()=>{0===f.length&&c.setError("There are no second factors available to add")},[]),c.error)?(0,r.tZ)(n.FormContainer,{headerTitle:m}):0!==f.length||s?(0,r.tZ)(eO,{onSuccess:t,onReset:i,method:s||f[0]}):null}),eO=e=>{let{method:t,onSuccess:i,onReset:o}=e;switch(t){case"phone_code":return(0,r.tZ)(eT,{onSuccess:i,onReset:o});case"totp":return(0,r.tZ)(eD,{onSuccess:i,onReset:o});case"backup_code":return(0,r.tZ)(ew,{onSuccess:i,onReset:o});default:return null}},e$=()=>{let{close:e}=(0,P.XC)();return(0,r.tZ)(x,{onSuccess:e,onReset:e})},eN=e=>{let{close:t}=(0,P.XC)();return(0,r.tZ)(B,{onSuccess:t,onReset:t,...e})},eM=()=>{let{close:e}=(0,P.XC)();return(0,r.tZ)(e_,{onSuccess:e,onReset:e})},eU=e=>{let{close:t}=(0,P.XC)();return(0,r.tZ)(eE,{onSuccess:t,onReset:t,selectedStrategy:e.selectedStrategy})},eW=()=>{let{userSettings:{attributes:e}}=(0,l.useEnvironment)(),{user:t}=(0,h.aF)();if(!t)return null;let i=X(e),o=L(e,t),s=i.includes("totp")&&t.totpEnabled,c=i.includes("backup_code")&&t.backupCodeEnabled,d=t.phoneNumbers.filter(e=>"verified"===e.verification.status).filter(e=>e.reservedForSecondFactor).sort(A);return(0,r.tZ)(n.ProfileSection.Root,{title:(0,a.localizationKeys)("userProfile.start.mfaSection.title"),centered:!1,id:"mfa",children:(0,r.tZ)(v.a.Root,{children:(0,r.BX)(n.ProfileSection.ItemList,{id:"mfa",children:[s&&(0,r.BX)(v.a.Root,{children:[(0,r.BX)(n.ProfileSection.Item,{id:"mfa",hoverable:!0,children:[(0,r.BX)(a.Flex,{sx:e=>({gap:e.space.$2,alignItems:"center"}),children:[(0,r.tZ)(a.Icon,{icon:eP.hc,sx:e=>({color:e.colors.$neutralAlpha700})}),(0,r.tZ)(a.Text,{localizationKey:(0,a.localizationKeys)("userProfile.start.mfaSection.totp.headerTitle")}),(0,r.tZ)(a.Badge,{localizationKey:(0,a.localizationKeys)("badge__default")})]}),(0,r.tZ)(eY,{})]}),(0,r.tZ)(v.a.Open,{value:"remove",children:(0,r.tZ)(v.a.Card,{variant:"destructive",children:(0,r.tZ)(e$,{})})})]}),i.includes("phone_code")&&d.map(e=>{let t=!s&&e.defaultSecondFactor;return(0,r.BX)(v.a.Root,{children:[(0,r.BX)(n.ProfileSection.Item,{id:"mfa",hoverable:!0,children:[(0,r.BX)(a.Flex,{sx:e=>({gap:e.space.$2,alignItems:"center"}),children:[(0,r.tZ)(a.Icon,{icon:eP.ij,sx:e=>({color:e.colors.$neutralAlpha700})}),(0,r.BX)(a.Text,{children:["SMS Code ",(0,r.tZ)(n.FormattedPhoneNumberText,{value:e.phoneNumber})]}),t&&(0,r.tZ)(a.Badge,{localizationKey:(0,a.localizationKeys)("badge__default")})]}),(0,r.tZ)(ej,{phone:e,showTOTP:s})]}),(0,r.tZ)(v.a.Open,{value:"remove",children:(0,r.tZ)(v.a.Card,{variant:"destructive",children:(0,r.tZ)(eN,{phoneId:e.id})})})]},e.id)}),c&&(0,r.BX)(v.a.Root,{children:[(0,r.BX)(n.ProfileSection.Item,{id:"mfa",hoverable:!0,children:[(0,r.BX)(a.Flex,{sx:e=>({gap:e.space.$2,alignItems:"center"}),children:[(0,r.tZ)(a.Icon,{icon:eP.Qi,sx:e=>({color:e.colors.$neutralAlpha700})}),(0,r.tZ)(a.Text,{localizationKey:(0,a.localizationKeys)("userProfile.start.mfaSection.backupCodes.headerTitle")})]}),(0,r.tZ)(eq,{})]}),(0,r.tZ)(v.a.Open,{value:"regenerate",children:(0,r.tZ)(v.a.Card,{children:(0,r.tZ)(eM,{})})})]}),(0,r.tZ)(eH,{secondFactorsAvailableToAdd:o})]})})})},ej=e=>{let{phone:t,showTOTP:i}=e,{open:o}=(0,P.XC)(),l=(0,n.useCardState)(),s=[i?null:{label:(0,a.localizationKeys)("userProfile.start.mfaSection.phoneCode.actionLabel__setDefault"),onClick:()=>t.makeDefaultSecondFactor().catch(e=>(0,y.S3)(e,[],l.setError)),isDisabled:t.defaultSecondFactor},{label:(0,a.localizationKeys)("userProfile.start.mfaSection.phoneCode.destructiveActionLabel"),isDestructive:!0,onClick:()=>o("remove")}].filter(e=>null!==e);return(0,r.tZ)(n.ThreeDotsMenu,{actions:s})},eq=()=>{let{open:e}=(0,P.XC)(),t=[{label:(0,a.localizationKeys)("userProfile.start.mfaSection.backupCodes.actionLabel__regenerate"),onClick:()=>e("regenerate")}].filter(e=>null!==e);return(0,r.tZ)(n.ThreeDotsMenu,{actions:t})},eY=()=>{let{open:e}=(0,P.XC)(),t=[{label:(0,a.localizationKeys)("userProfile.start.mfaSection.totp.destructiveActionTitle"),isDestructive:!0,onClick:()=>e("remove")}].filter(e=>null!==e);return(0,r.tZ)(n.ThreeDotsMenu,{actions:t})},eH=e=>{let{open:t}=(0,P.XC)(),{secondFactorsAvailableToAdd:i}=e,[l,s]=(0,o.useState)(),c=o.useMemo(()=>i.map(e=>"phone_code"===e?{icon:eP.ij,text:"SMS code",key:"phone_code"}:"totp"===e?{icon:eP.hc,text:"Authenticator application",key:"totp"}:"backup_code"===e?{icon:eP.Qi,text:"Backup code",key:"backup_code"}:null).filter(e=>null!==e),[i]);return(0,r.BX)(r.HY,{children:[i.length>0&&(0,r.tZ)(v.a.Closed,{value:"multi-factor",children:(0,r.tZ)(n.ProfileSection.ActionMenu,{id:"mfa",triggerLocalizationKey:(0,a.localizationKeys)("userProfile.start.mfaSection.primaryButton"),children:c.map(e=>e&&(0,r.tZ)(n.ProfileSection.ActionMenuItem,{id:e.key,localizationKey:e.text,leftIcon:e.icon,onClick:()=>{s(e.key),t("multi-factor")}},e.key))})}),(0,r.tZ)(v.a.Open,{value:"multi-factor",children:(0,r.tZ)(v.a.Card,{children:l&&(0,r.tZ)(eU,{selectedStrategy:l})})})]})},eV=e=>{let{close:t}=(0,P.XC)();return(0,r.tZ)(R,{onSuccess:t,onReset:t,...e})},eJ=e=>{let{close:t}=(0,P.XC)();return(0,r.tZ)(eQ,{onSuccess:t,onReset:t,passkey:e.passkey})},eQ=(0,n.withCardStateProvider)(e=>{let{onSuccess:t,onReset:i,passkey:o}=e,l=(0,n.useCardState)(),s=(0,y.Yp)("passkeyName",o.name||"",{type:"text",label:(0,a.localizationKeys)("formFieldLabel__passkeyName"),isRequired:!0}),c=s.value.length>1&&o.name!==s.value,d=async e=>(e.preventDefault(),o.update({name:s.value}).then(t).catch(e=>(0,y.S3)(e,[s],l.setError)));return(0,r.tZ)(n.FormContainer,{headerTitle:(0,a.localizationKeys)("userProfile.passkeyScreen.title__rename"),headerSubtitle:(0,a.localizationKeys)("userProfile.passkeyScreen.subtitle__rename"),children:(0,r.BX)(n.Form.Root,{onSubmit:d,children:[(0,r.tZ)(n.Form.ControlRow,{elementId:s.id,children:(0,r.tZ)(n.Form.PlainInput,{...s.props,autoComplete:"off"})}),(0,r.tZ)(n.FormButtons,{submitLabel:(0,a.localizationKeys)("userProfile.formButtonPrimary__save"),isDisabled:!c,onReset:i})]})})}),eG=()=>{let{user:e}=(0,h.aF)();return e?(0,r.tZ)(n.ProfileSection.Root,{title:(0,a.localizationKeys)("userProfile.start.passkeysSection.title"),centered:!1,id:"passkeys",children:(0,r.BX)(n.ProfileSection.ItemList,{id:"passkeys",children:[e.passkeys.map(e=>(0,r.BX)(v.a.Root,{children:[(0,r.tZ)(e0,{...e},e.id),(0,r.tZ)(v.a.Open,{value:"remove",children:(0,r.tZ)(v.a.Card,{variant:"destructive",children:(0,r.tZ)(eV,{passkey:e})})}),(0,r.tZ)(v.a.Open,{value:"rename",children:(0,r.tZ)(v.a.Card,{children:(0,r.tZ)(eJ,{passkey:e})})})]},e.id)),(0,r.tZ)(e3,{})]})}):null},e0=e=>(0,r.BX)(n.ProfileSection.Item,{id:"passkeys",hoverable:!0,sx:{alignItems:"flex-start"},children:[(0,r.tZ)(e1,{...e}),(0,r.tZ)(e2,{})]}),e1=e=>{let{name:t,createdAt:i,lastUsedAt:o}=e,{t:l}=(0,a.useLocalizations)();return(0,r.tZ)(a.Flex,{sx:e=>({width:"100%",overflow:"hidden",gap:e.space.$4,[ei.mqu.sm]:{gap:e.space.$2}}),children:(0,r.BX)(a.Col,{align:"start",gap:1,children:[(0,r.tZ)(a.Text,{children:t}),(0,r.BX)(a.Text,{colorScheme:"secondary",children:["Created: ",l((0,y.Qg)(i))]}),o&&(0,r.BX)(a.Text,{colorScheme:"secondary",children:["Last used: ",l((0,y.Qg)(o))]})]})})},e2=()=>{let{open:e}=(0,P.XC)(),t=[{label:(0,a.localizationKeys)("userProfile.start.passkeysSection.menuAction__rename"),onClick:()=>e("rename")},{label:(0,a.localizationKeys)("userProfile.start.passkeysSection.menuAction__destructive"),isDestructive:!0,onClick:()=>e("remove")}];return(0,r.tZ)(n.ThreeDotsMenu,{actions:t})},e3=()=>{let e=(0,n.useCardState)(),{isSatellite:t}=(0,h.cL)(),{user:i}=(0,h.aF)(),[o]=(0,h.jJ)(()=>i?i.createPasskey():Promise.resolve(void 0)),l=async()=>{if(i)try{await o()}catch(t){(0,y.S3)(t,[],e.setError)}};return t?null:(0,r.tZ)(n.ProfileSection.ArrowButton,{id:"passkeys",localizationKey:"Add a passkey",onClick:l})},e4=(e,t)=>{let i=[];return e?i.push((0,a.localizationKeys)("userProfile.passwordPage.successMessage__update")):i.push((0,a.localizationKeys)("userProfile.passwordPage.successMessage__set")),t&&i.push((0,a.localizationKeys)("userProfile.passwordPage.successMessage__signOutOfOtherSessions")),i},e5=(0,n.withCardStateProvider)(e=>{let{onSuccess:t,onReset:i}=e,{user:s}=(0,h.aF)(),[c]=(0,h.jJ)(()=>{if(!s)return Promise.resolve(void 0);let e={newPassword:Z.value,signOutOfOtherSessions:S.checked,currentPassword:s.passwordEnabled?v.value:void 0};return s.updatePassword(e)});if(!s)return null;let{session:d}=(0,h.kP)(),u=s.passwordEnabled?(0,a.localizationKeys)("userProfile.passwordPage.title__update"):(0,a.localizationKeys)("userProfile.passwordPage.title__set"),m=(0,n.useCardState)(),f=s.samlAccounts.some(e=>e.active),p=(0,o.useRef)({title:(0,a.localizationKeys)("userProfile.passwordPage.title__set")}),v=(0,y.Yp)("currentPassword","",{type:"password",label:(0,a.localizationKeys)("formFieldLabel__currentPassword"),isRequired:!0}),{userSettings:{passwordSettings:P}}=(0,l.useEnvironment)(),Z=(0,y.Yp)("newPassword","",{type:"password",label:(0,a.localizationKeys)("formFieldLabel__newPassword"),isRequired:!0,validatePassword:!0,buildErrorMessage:e=>(0,y.GM)(e,{t:K,locale:B,passwordSettings:P})}),b=(0,y.Yp)("confirmPassword","",{type:"password",label:(0,a.localizationKeys)("formFieldLabel__confirmPassword"),isRequired:!0}),S=(0,y.Yp)("signOutOfOtherSessions","",{type:"checkbox",label:(0,a.localizationKeys)("formFieldLabel__signOutOfOtherSessions"),defaultChecked:!0}),{setConfirmPasswordFeedback:C,isPasswordMatch:z}=(0,g.p5)({passwordField:Z,confirmPasswordField:b}),{t:K,locale:B}=(0,a.useLocalizations)(),x=(s.passwordEnabled?v.value&&z:z)&&Z.value&&b.value,R=async()=>{try{p.current={title:s.passwordEnabled?(0,a.localizationKeys)("userProfile.passwordPage.title__update"):(0,a.localizationKeys)("userProfile.passwordPage.title__set"),text:e4(s.passwordEnabled,!!S.checked)},await c(),t()}catch(e){(0,y.S3)(e,[v,Z,b],m.setError)}};return(0,r.BX)(n.FormContainer,{headerTitle:u,children:[f&&(0,r.tZ)(n.InformationBox,{message:(0,a.localizationKeys)("userProfile.passwordPage.readonly")}),(0,r.BX)(n.Form.Root,{onSubmit:R,onBlur:()=>{Z.value&&C(b.value)},children:[(0,r.tZ)("input",{readOnly:!0,"data-testid":"hidden-identifier",id:"identifier-field",name:"identifier",value:(null==d?void 0:d.publicUserData.identifier)||"",style:{display:"none"}}),s.passwordEnabled&&(0,r.tZ)(n.Form.ControlRow,{elementId:v.id,children:(0,r.tZ)(n.Form.PasswordInput,{...v.props,minLength:6,isRequired:!0,autoFocus:!0,isDisabled:f})}),(0,r.tZ)(n.Form.ControlRow,{elementId:Z.id,children:(0,r.tZ)(n.Form.PasswordInput,{...Z.props,minLength:6,isRequired:!0,autoFocus:!s.passwordEnabled,isDisabled:f})}),(0,r.tZ)(n.Form.ControlRow,{elementId:b.id,children:(0,r.tZ)(n.Form.PasswordInput,{...b.props,onChange:e=>(e.target.value&&C(e.target.value),b.props.onChange(e)),isRequired:!0,isDisabled:f})}),(0,r.tZ)(n.Form.ControlRow,{elementId:S.id,children:(0,r.tZ)(n.Form.Checkbox,{...S.props,description:(0,a.localizationKeys)("userProfile.passwordPage.checkboxInfoText__signOutOfOtherSessions"),isDisabled:f})}),f?(0,r.tZ)(n.FormButtonContainer,{children:(0,r.tZ)(n.Form.ResetButton,{localizationKey:(0,a.localizationKeys)("userProfile.formButtonReset"),block:!1,onClick:i})}):(0,r.tZ)(n.FormButtons,{isDisabled:!x,onReset:i})]})]})}),e6=()=>{let{close:e}=(0,P.XC)();return(0,r.tZ)(e5,{onSuccess:e,onReset:e})},e8=()=>{let{user:e}=(0,h.aF)();if(!e)return null;let{passwordEnabled:t}=e;return(0,r.tZ)(n.ProfileSection.Root,{centered:!1,title:(0,a.localizationKeys)("userProfile.start.passwordSection.title"),id:"password",children:(0,r.BX)(v.a.Root,{children:[(0,r.tZ)(v.a.Closed,{value:"edit",children:(0,r.BX)(n.ProfileSection.Item,{id:"password",sx:e=>({paddingLeft:t?void 0:"0",paddingTop:e.space.$0x25,paddingBottom:e.space.$0x25}),children:[t&&(0,r.tZ)(a.Text,{variant:"h2",children:"••••••••••"}),(0,r.tZ)(v.a.Trigger,{value:"edit",children:(0,r.tZ)(n.ProfileSection.Button,{id:"password",localizationKey:t?(0,a.localizationKeys)("userProfile.start.passwordSection.primaryButton__updatePassword"):(0,a.localizationKeys)("userProfile.start.passwordSection.primaryButton__setPassword")})})]})}),(0,r.tZ)(v.a.Open,{value:"edit",children:(0,r.tZ)(v.a.Card,{children:(0,r.tZ)(e6,{})})})]})})},e7=(0,n.withCardStateProvider)(()=>{let{attributes:e,instanceIsPasswordBased:t}=(0,l.useEnvironment)().userSettings,i=(0,n.useCardState)(),{user:o}=(0,h.aF)(),s=e.passkey.enabled,c=X(e).length>0,d=null==o?void 0:o.deleteSelfEnabled;return(0,r.tZ)(a.Col,{elementDescriptor:a.descriptors.page,sx:e=>({gap:e.space.$8}),children:(0,r.BX)(a.Col,{elementDescriptor:a.descriptors.profilePage,elementId:a.descriptors.profilePage.setId("security"),children:[(0,r.tZ)(n.Header.Root,{children:(0,r.tZ)(n.Header.Title,{localizationKey:(0,a.localizationKeys)("userProfile.start.headerTitle__security"),sx:e=>({marginBottom:e.space.$4}),textVariant:"h2"})}),(0,r.tZ)(n.Card.Alert,{children:i.error}),t&&(0,r.tZ)(e8,{}),s&&(0,r.tZ)(eG,{}),c&&(0,r.tZ)(eW,{}),(0,r.tZ)(eg,{}),d&&(0,r.tZ)(eK,{})]})})}),e9=()=>{var e;let{pages:t}=(0,l.useUserProfileContext)(),i=t.routes[0].id===m.xM.ACCOUNT,o=t.routes[0].id===m.xM.SECURITY,a=null===(e=t.contents)||void 0===e?void 0:e.map((e,t)=>{let l=!i&&!o&&0===t;return(0,r.tZ)(s.Route,{index:l,path:l?void 0:e.url,children:(0,r.tZ)(u.O,{mount:e.mount,unmount:e.unmount})},"custom-page-".concat(e.url))});return(0,r.BX)(s.Switch,{children:[a,(0,r.BX)(s.Route,{children:[(0,r.tZ)(s.Route,{path:i?void 0:"account",children:(0,r.tZ)(s.Switch,{children:(0,r.tZ)(s.Route,{index:!0,children:(0,r.tZ)(ev,{})})})}),(0,r.tZ)(s.Route,{path:o?void 0:"security",children:(0,r.tZ)(s.Switch,{children:(0,r.tZ)(s.Route,{index:!0,children:(0,r.tZ)(e7,{})})})})]})]})},te=(0,l.withCoreUserGuard)(()=>{let e=o.useRef(null);return(0,r.tZ)(n.ProfileCard.Root,{children:(0,r.BX)(d,{contentRef:e,children:[(0,r.tZ)(n.NavbarMenuButtonRow,{navbarTitleLocalizationKey:(0,a.localizationKeys)("userProfile.navbar.title")}),(0,r.tZ)(n.ProfileCard.Content,{contentRef:e,children:(0,r.tZ)(e9,{})})]})})}),tt=(0,n.withCardStateProvider)(e=>(0,r.tZ)(a.Flow.Root,{flow:"userProfile",children:(0,r.tZ)(a.Flow.Part,{children:(0,r.BX)(s.Switch,{children:[(0,r.tZ)(s.Route,{path:"verify",children:(0,r.tZ)(N,{})}),(0,r.tZ)(s.Route,{children:(0,r.tZ)(te,{})})]})})})),ti=e=>{let t={...e,routing:"virtual",componentName:"UserProfile",mode:"modal"};return(0,r.tZ)(s.Route,{path:"user",children:(0,r.tZ)(l.UserProfileContext.Provider,{value:t,children:(0,r.tZ)("div",{children:(0,r.tZ)(tt,{...t})})})})}}}]);