"use strict";(globalThis.webpackChunk_clerk_clerk_js=globalThis.webpackChunk_clerk_clerk_js||[]).push([["662"],{7389:function(e,t,r){r.d(t,{v:function(){return n}});var i=r(2903),o=r(3064),a=r(9885);let n=e=>{let{onBackLinkClick:t}=e;return(0,i.tZ)(a.ErrorCard,{cardTitle:(0,o.localizationKeys)("signIn.alternativeMethods.getHelp.title"),cardSubtitle:(0,o.localizationKeys)("signIn.alternativeMethods.getHelp.content"),onBackLinkClick:t})}},5518:function(e,t,r){r.d(t,{Vh:function(){return _},bx:function(){return u},t3:function(){return c},xT:function(){return d}}),r(5670);var i=r(5263),o=r(7772),a=r(577);let n=e=>t=>"safeIdentifier"in t&&t.safeIdentifier===e;function l(e){if((0,i.iW)()){let t=e.find(e=>{let{strategy:t}=e;return"passkey"===t});if(t)return t}return null}function c(e,t,r){return e&&0!==e.length?r===o.kJ.Password?function(e,t){let r=l(e);if(r)return r;let i=e.sort(a.sZ)[0];return"password"===i.strategy?i:e.find(n(t))||i||null}(e,t):function(e,t){let r=l(e);if(r)return r;let i=e.sort(a.b8),o=i.find(n(t));if(o)return o;let c=i[0];return"email_link"===c.strategy?c:e.find(n(t))||c||null}(e,t):null}let s=["passkey","email_code","password","phone_code","email_link"];function d(e){return!!e&&s.includes(e.strategy)}function u(e){if(!e||0===e.length)return null;let t=e.find(e=>"totp"===e.strategy);if(t)return t;let r=e.find(e=>"phone_code"===e.strategy);return r||e[0]}let p=["reset_password_phone_code","reset_password_email_code"],_=e=>!!e&&p.includes(e)},252:function(e,t,r){r.r(t),r.d(t,{UserVerification:()=>U,UserVerificationModal:()=>N});var i=r("2903"),o=r("2784"),a=r("7571"),n=r("3064"),l=r("4676"),c=r("9885"),s=r("1752"),d=r("1085"),u=r("5518"),p=r("9037"),_=r("8655"),f=r("1132"),h=r("9366"),m=r("242");let C=()=>{let{level:e}=(0,a.useUserVerification)();return(0,o.useMemo)(()=>({level:e||"secondFactor"}),[e])},k=()=>{let{session:e}=(0,h.kP)(),t=C();return{...(0,m.ib)(e?e.__experimental_startVerification:void 0,t,{throttleTime:300})}};function v(e){let t=t=>{let{isLoading:r,data:o}=k();return r||!o?(0,i.tZ)(c.LoadingCard,{}):(0,i.tZ)(e,{...t})},r=e.displayName||e.name||"Component";return e.displayName=r,t.displayName=r,t}let y=e=>{let{onBackLinkClick:t}=e;return(0,i.tZ)(c.ErrorCard,{cardTitle:(0,n.localizationKeys)("__experimental_userVerification.alternativeMethods.getHelp.title"),cardSubtitle:(0,n.localizationKeys)("__experimental_userVerification.alternativeMethods.getHelp.content"),onBackLinkClick:t})},b=(e,t)=>{let[r,a]=o.useState(!1),n=o.useCallback(()=>a(e=>!e),[a]);return r?(0,i.tZ)(y,{onBackLinkClick:n}):(0,i.tZ)(e,{...t,onHavingTroubleClick:n})},Z=e=>b(w,{...e}),w=e=>{let{onBackLinkClick:t,onHavingTroubleClick:r,onFactorSelected:o}=e,a=(0,p.v)(),{data:l}=k(),{firstPartyFactors:d,hasAnyStrategy:u}=(0,s.l)({filterOutFactor:null==e?void 0:e.currentFactor,supportedFirstFactors:l.supportedFirstFactors});return(0,i.tZ)(n.Flow.Part,{part:"alternativeMethods",children:(0,i.BX)(c.Card.Root,{children:[(0,i.BX)(c.Card.Content,{children:[(0,i.BX)(c.Header.Root,{showLogo:!0,children:[(0,i.tZ)(c.Header.Title,{localizationKey:(0,n.localizationKeys)("__experimental_userVerification.alternativeMethods.title")}),(0,i.tZ)(c.Header.Subtitle,{localizationKey:(0,n.localizationKeys)("__experimental_userVerification.alternativeMethods.subtitle")})]}),(0,i.tZ)(c.Card.Alert,{children:a.error}),(0,i.tZ)(n.Flex,{direction:"col",elementDescriptor:n.descriptors.main,gap:6,children:(0,i.BX)(n.Col,{gap:4,children:[u&&(0,i.tZ)(n.Flex,{elementDescriptor:n.descriptors.alternativeMethods,direction:"col",gap:2,children:d.map((e,t)=>{var r;return(0,i.tZ)(c.ArrowBlockButton,{leftIcon:(r=e,({email_code:_.GT,phone_code:_.iU,password:_.kh})[r.strategy]),textLocalizationKey:function(e){switch(e.strategy){case"email_code":return(0,n.localizationKeys)("__experimental_userVerification.alternativeMethods.blockButton__emailCode",{identifier:(0,f.HT)(e.safeIdentifier)||""});case"phone_code":return(0,n.localizationKeys)("__experimental_userVerification.alternativeMethods.blockButton__phoneCode",{identifier:(0,f.HT)(e.safeIdentifier)||""});case"password":return(0,n.localizationKeys)("__experimental_userVerification.alternativeMethods.blockButton__password");default:throw'Invalid sign in strategy: "'.concat(e.strategy,'"')}}(e),elementDescriptor:n.descriptors.alternativeMethodsBlockButton,textElementDescriptor:n.descriptors.alternativeMethodsBlockButtonText,arrowElementDescriptor:n.descriptors.alternativeMethodsBlockButtonArrow,textVariant:"buttonLarge",isDisabled:a.isLoading,onClick:()=>{a.setError(void 0),o(e)}},t)})}),t&&(0,i.tZ)(c.BackLink,{boxElementDescriptor:n.descriptors.backRow,linkElementDescriptor:n.descriptors.backLink,onClick:t})]})})]}),(0,i.tZ)(c.Card.Footer,{children:(0,i.BX)(c.Card.Action,{elementId:"havingTrouble",children:[(0,i.tZ)(c.Card.ActionText,{localizationKey:(0,n.localizationKeys)("__experimental_userVerification.alternativeMethods.actionText")}),(0,i.tZ)(c.Card.ActionLink,{localizationKey:(0,n.localizationKeys)("__experimental_userVerification.alternativeMethods.actionLink"),onClick:r})]})})]})})};var F=r("7389"),g=r("4152"),B=r("3234");let x=()=>{let{afterVerification:e}=(0,a.useUserVerification)(),t=(0,B.H)(),{setActive:r}=(0,h.cL)(),{setCache:i}=k(),{navigate:n}=(0,l.useRouter)();return{handleVerificationResponse:(0,o.useCallback)(async o=>{switch(i({data:o,isLoading:!1,isValidating:!1,error:null,cachedAt:Date.now()}),o.status){case"complete":return await r({session:o.session.id}),null==e?void 0:e();case"needs_second_factor":return n("./factor-two");default:return console.error((0,g.Ws)(o.status,t))}},[n,r,t])}};function S(e){let{onShowAlternativeMethodsClick:t}=e,{session:r}=(0,h.kP)(),{handleVerificationResponse:a}=x(),l=(0,c.useCardState)(),[s,d]=o.useState(!1),u=o.useCallback(()=>d(e=>!e),[d]),p=(0,f.Yp)("password","",{type:"password",label:(0,n.localizationKeys)("formFieldLabel__password"),placeholder:(0,n.localizationKeys)("formFieldInputPlaceholder__password")}),_=async e=>(e.preventDefault(),null==r?void 0:r.__experimental_attemptFirstFactorVerification({strategy:"password",password:p.value}).then(a).catch(e=>(0,f.S3)(e,[p],l.setError)));return s?(0,i.tZ)(F.v,{onBackLinkClick:u}):(0,i.tZ)(n.Flow.Part,{part:"password",children:(0,i.BX)(c.Card.Root,{children:[(0,i.BX)(c.Card.Content,{children:[(0,i.BX)(c.Header.Root,{showLogo:!0,children:[(0,i.tZ)(c.Header.Title,{localizationKey:(0,n.localizationKeys)("__experimental_userVerification.password.title")}),(0,i.tZ)(c.Header.Subtitle,{localizationKey:(0,n.localizationKeys)("__experimental_userVerification.password.subtitle")})]}),(0,i.tZ)(c.Card.Alert,{children:l.error}),(0,i.BX)(n.Col,{elementDescriptor:n.descriptors.main,gap:4,children:[(0,i.BX)(c.Form.Root,{onSubmit:_,gap:8,children:[(0,i.tZ)(c.Form.ControlRow,{elementId:p.id,children:(0,i.tZ)(c.Form.PasswordInput,{...p.props,autoFocus:!0})}),(0,i.tZ)(c.Form.SubmitButton,{hasArrow:!0})]}),(0,i.tZ)(c.Card.Action,{elementId:t?"alternativeMethods":"havingTrouble",children:(0,i.tZ)(c.Card.ActionLink,{localizationKey:(0,n.localizationKeys)(t?"__experimental_userVerification.password.actionLink":"__experimental_userVerification.alternativeMethods.actionLink"),onClick:t||u})})]})]}),(0,i.tZ)(c.Card.Footer,{})]})})}let V=e=>{var t;let{session:r}=(0,h.kP)(),a=(0,c.useCardState)(),{handleVerificationResponse:n}=x();o.useEffect(()=>{e.factorAlreadyPrepared||l()},[]);let l=()=>{r.__experimental_prepareFirstFactorVerification(e.factor).then(()=>e.onFactorPrepare()).catch(e=>(0,f.S3)(e,[],a.setError))};return(0,i.tZ)(c.VerificationCodeCard,{cardTitle:e.cardTitle,cardSubtitle:e.cardSubtitle,inputLabel:e.inputLabel,resendButton:e.resendButton,onCodeEntryFinishedAction:(t,i,o)=>{r.__experimental_attemptFirstFactorVerification({strategy:e.factor.strategy,code:t}).then(async e=>(await i(),n(e))).catch(o)},onResendCodeClicked:l,safeIdentifier:e.factor.safeIdentifier,profileImageUrl:null==r?void 0:null===(t=r.user)||void 0===t?void 0:t.imageUrl,onShowAlternativeMethodsClicked:e.onShowAlternativeMethodsClicked,showAlternativeMethods:e.showAlternativeMethods,onBackLinkClicked:e.onBackLinkClicked})},z=e=>(0,i.tZ)(n.Flow.Part,{part:"emailCode",children:(0,i.tZ)(V,{...e,cardTitle:(0,n.localizationKeys)("__experimental_userVerification.emailCode.title"),cardSubtitle:(0,n.localizationKeys)("__experimental_userVerification.emailCode.subtitle"),inputLabel:(0,n.localizationKeys)("__experimental_userVerification.emailCode.formTitle"),resendButton:(0,n.localizationKeys)("__experimental_userVerification.emailCode.resendButton")})}),K=e=>(0,i.tZ)(n.Flow.Part,{part:"phoneCode",children:(0,i.tZ)(V,{...e,cardTitle:(0,n.localizationKeys)("__experimental_userVerification.phoneCode.title"),cardSubtitle:(0,n.localizationKeys)("__experimental_userVerification.phoneCode.subtitle"),inputLabel:(0,n.localizationKeys)("__experimental_userVerification.phoneCode.formTitle"),resendButton:(0,n.localizationKeys)("__experimental_userVerification.phoneCode.resendButton")})}),M=e=>{if(!e)return"";let t=e.strategy;return"emailAddressId"in e&&(t+=e.emailAddressId),"phoneNumberId"in e&&(t+=e.phoneNumberId),t},A=v((0,c.withCardStateProvider)(function(){let{data:e}=k(),t=(0,c.useCardState)(),{navigate:r}=(0,l.useRouter)(),n=o.useRef(""),p=e.supportedFirstFactors,{preferredSignInStrategy:_}=(0,a.useEnvironment)().displayConfig,[{currentFactor:f},h]=o.useState(()=>({currentFactor:(0,u.t3)(p,null,_),prevCurrentFactor:void 0})),{hasAnyStrategy:m}=(0,s.l)({filterOutFactor:f,supportedFirstFactors:p}),[C,v]=o.useState(()=>!f||!(0,u.xT)(f)),y=m?()=>v(e=>!e):void 0,b=()=>{n.current=M(f)},w=e=>{h(t=>({currentFactor:e,prevCurrentFactor:t.currentFactor}))};if((0,o.useEffect)(()=>{"needs_second_factor"===e.status&&r("factor-two")},[]),!f)return(0,i.tZ)(c.ErrorCard,{cardTitle:(0,d.u1)("__experimental_userVerification.noAvailableMethods.title"),cardSubtitle:(0,d.u1)("__experimental_userVerification.noAvailableMethods.subtitle"),message:(0,d.u1)("__experimental_userVerification.noAvailableMethods.message"),shouldNavigateBack:!1});if(C){let e=(0,u.xT)(f);return(0,i.tZ)(Z,{onBackLinkClick:e?()=>{t.setError(void 0),null==y||y()}:void 0,onFactorSelected:e=>{w(e),null==y||y()},currentFactor:f})}switch(null==f?void 0:f.strategy){case"password":return(0,i.tZ)(S,{onShowAlternativeMethodsClick:y});case"email_code":return(0,i.tZ)(z,{factorAlreadyPrepared:n.current===M(f),onFactorPrepare:b,onShowAlternativeMethodsClicked:y,factor:f});case"phone_code":return(0,i.tZ)(K,{factorAlreadyPrepared:n.current===M(f),onFactorPrepare:b,onShowAlternativeMethodsClicked:y,factor:f});default:return(0,i.tZ)(c.LoadingCard,{})}})),L=e=>{var t;let r=(0,c.useCardState)(),{session:a}=(0,h.kP)(),{handleVerificationResponse:n}=x();o.useEffect(()=>{!e.factorAlreadyPrepared&&(null==l||l())},[]);let l=e.prepare?()=>{var t;return null===(t=e.prepare)||void 0===t?void 0:t.call(e).then(()=>e.onFactorPrepare()).catch(e=>(0,f.S3)(e,[],r.setError))}:void 0;return(0,i.tZ)(c.VerificationCodeCard,{cardTitle:e.cardTitle,cardSubtitle:e.cardSubtitle,resendButton:e.resendButton,inputLabel:e.inputLabel,onCodeEntryFinishedAction:(t,r,i)=>{a.__experimental_attemptSecondFactorVerification({strategy:e.factor.strategy,code:t}).then(async e=>(await r(),n(e))).catch(i)},onResendCodeClicked:l,safeIdentifier:"safeIdentifier"in e.factor?e.factor.safeIdentifier:void 0,profileImageUrl:null==a?void 0:null===(t=a.user)||void 0===t?void 0:t.imageUrl,onShowAlternativeMethodsClicked:e.onShowAlternativeMethodsClicked})};function T(e){return(0,i.tZ)(n.Flow.Part,{part:"totp2Fa",children:(0,i.tZ)(L,{...e,cardTitle:(0,n.localizationKeys)("__experimental_userVerification.totpMfa.title"),cardSubtitle:(0,n.localizationKeys)("__experimental_userVerification.totpMfa.subtitle"),inputLabel:(0,n.localizationKeys)("__experimental_userVerification.totpMfa.formTitle")})})}let I=e=>{let[t,r]=o.useState(!1),a=o.useCallback(()=>r(e=>!e),[r]);return t?(0,i.tZ)(y,{onBackLinkClick:a}):(0,i.tZ)(P,{supportedSecondFactors:e.supportedSecondFactors,onBackLinkClick:e.onBackLinkClick,onFactorSelected:e.onFactorSelected,onHavingTroubleClick:a})},P=e=>{let{supportedSecondFactors:t,onHavingTroubleClick:r,onFactorSelected:o,onBackLinkClick:a}=e,l=(0,p.v)();return(0,i.tZ)(n.Flow.Part,{part:"alternativeMethods",children:(0,i.BX)(c.Card.Root,{children:[(0,i.BX)(c.Card.Content,{children:[(0,i.BX)(c.Header.Root,{showLogo:!0,children:[(0,i.tZ)(c.Header.Title,{localizationKey:(0,n.localizationKeys)("__experimental_userVerification.alternativeMethods.title")}),(0,i.tZ)(c.Header.Subtitle,{localizationKey:(0,n.localizationKeys)("__experimental_userVerification.alternativeMethods.subtitle")})]}),(0,i.tZ)(c.Card.Alert,{children:l.error}),(0,i.BX)(n.Col,{elementDescriptor:n.descriptors.main,gap:3,children:[(0,i.tZ)(n.Col,{gap:2,children:null==t?void 0:t.sort(f.Q0).map((e,t)=>(0,i.tZ)(c.ArrowBlockButton,{textLocalizationKey:function(e){switch(e.strategy){case"phone_code":return(0,n.localizationKeys)("__experimental_userVerification.alternativeMethods.blockButton__phoneCode",{identifier:(0,f.HT)(e.safeIdentifier)||""});case"totp":return(0,n.localizationKeys)("__experimental_userVerification.alternativeMethods.blockButton__totp");case"backup_code":return(0,n.localizationKeys)("__experimental_userVerification.alternativeMethods.blockButton__backupCode");default:throw'Invalid verification strategy: "'.concat(e.strategy,'"')}}(e),elementDescriptor:n.descriptors.alternativeMethodsBlockButton,textElementDescriptor:n.descriptors.alternativeMethodsBlockButtonText,arrowElementDescriptor:n.descriptors.alternativeMethodsBlockButtonArrow,isDisabled:l.isLoading,onClick:()=>o(e)},t))}),(0,i.tZ)(c.Card.Action,{elementId:"alternativeMethods",children:a&&(0,i.tZ)(c.Card.ActionLink,{localizationKey:(0,n.localizationKeys)("backButton"),onClick:e.onBackLinkClick})})]})]}),(0,i.tZ)(c.Card.Footer,{children:(0,i.BX)(c.Card.Action,{elementId:"havingTrouble",children:[(0,i.tZ)(c.Card.ActionText,{localizationKey:(0,n.localizationKeys)("__experimental_userVerification.alternativeMethods.actionText")}),(0,i.tZ)(c.Card.ActionLink,{localizationKey:(0,n.localizationKeys)("__experimental_userVerification.alternativeMethods.actionLink"),onClick:r})]})})]})})},R=e=>{let{onShowAlternativeMethodsClicked:t}=e,{session:r}=(0,h.kP)(),{handleVerificationResponse:o}=x(),a=(0,c.useCardState)(),l=(0,f.Yp)("code","",{type:"text",label:(0,n.localizationKeys)("formFieldLabel__backupCode"),isRequired:!0});return(0,i.BX)(c.Card.Root,{children:[(0,i.BX)(c.Card.Content,{children:[(0,i.BX)(c.Header.Root,{showLogo:!0,children:[(0,i.tZ)(c.Header.Title,{localizationKey:(0,n.localizationKeys)("__experimental_userVerification.backupCodeMfa.title")}),(0,i.tZ)(c.Header.Subtitle,{localizationKey:(0,n.localizationKeys)("__experimental_userVerification.backupCodeMfa.subtitle")})]}),(0,i.tZ)(c.Card.Alert,{children:a.error}),(0,i.tZ)(n.Col,{elementDescriptor:n.descriptors.main,gap:8,children:(0,i.BX)(c.Form.Root,{onSubmit:e=>(e.preventDefault(),r.__experimental_attemptSecondFactorVerification({strategy:"backup_code",code:l.value}).then(o).catch(e=>(0,f.S3)(e,[l],a.setError))),children:[(0,i.tZ)(c.Form.ControlRow,{elementId:l.id,children:(0,i.tZ)(c.Form.PlainInput,{...l.props,autoFocus:!0,onActionClicked:t})}),(0,i.BX)(n.Col,{gap:3,children:[(0,i.tZ)(c.Form.SubmitButton,{hasArrow:!0}),(0,i.tZ)(c.Card.Action,{elementId:"alternativeMethods",children:t&&(0,i.tZ)(c.Card.ActionLink,{localizationKey:(0,n.localizationKeys)("footerActionLink__useAnotherMethod"),onClick:t})})]})]})})]}),(0,i.tZ)(c.Card.Footer,{})]})},E=e=>{let{session:t}=(0,h.kP)();return(0,i.tZ)(n.Flow.Part,{part:"phoneCode2Fa",children:(0,i.tZ)(L,{...e,cardTitle:(0,n.localizationKeys)("__experimental_userVerification.phoneCodeMfa.title"),cardSubtitle:(0,n.localizationKeys)("__experimental_userVerification.phoneCodeMfa.subtitle"),inputLabel:(0,n.localizationKeys)("__experimental_userVerification.phoneCodeMfa.formTitle"),resendButton:(0,n.localizationKeys)("__experimental_userVerification.phoneCodeMfa.resendButton"),prepare:()=>{let{phoneNumberId:r,strategy:i}=e.factor;return t.__experimental_prepareSecondFactorVerification({phoneNumberId:r,strategy:i})}})})},H=e=>{if(!e)return"";let t=e.strategy;return"phoneNumberId"in e&&(t+=e.phoneNumberId),t},X=v((0,c.withCardStateProvider)(function(){let{navigate:e}=(0,l.useRouter)(),{data:t}=k(),r=t.supportedSecondFactors,a=o.useRef(""),[n,s]=o.useState(()=>(0,u.bx)(r)),[d,p]=o.useState(!n),_=()=>p(e=>!e),f=()=>{a.current=H(n)};if((0,o.useEffect)(()=>{"needs_first_factor"===t.status&&e("../")},[]),!n)return(0,i.tZ)(c.LoadingCard,{});if(d)return(0,i.tZ)(I,{supportedSecondFactors:t.supportedSecondFactors,onBackLinkClick:_,onFactorSelected:e=>{s(e),_()}});switch(null==n?void 0:n.strategy){case"phone_code":return(0,i.tZ)(E,{factorAlreadyPrepared:a.current===H(n),onFactorPrepare:f,factor:n,onShowAlternativeMethodsClicked:_});case"totp":return(0,i.tZ)(T,{factorAlreadyPrepared:a.current===H(n),onFactorPrepare:f,factor:n,onShowAlternativeMethodsClicked:_});case"backup_code":return(0,i.tZ)(R,{onShowAlternativeMethodsClicked:_});default:return(0,i.tZ)(c.LoadingCard,{})}}));function D(){let{invalidate:e}=k();return(0,o.useEffect)(()=>()=>{e()},[]),(0,i.tZ)(n.Flow.Root,{flow:"userVerification",children:(0,i.BX)(l.Switch,{children:[(0,i.tZ)(l.Route,{path:"factor-two",children:(0,i.tZ)(X,{})}),(0,i.tZ)(l.Route,{index:!0,children:(0,i.tZ)(A,{})})]})})}D.displayName="UserVerification";let U=(0,a.withCoreSessionSwitchGuard)(D),N=e=>(0,i.tZ)(l.Route,{path:"user-verification",children:(0,i.tZ)(a.UserVerificationContext.Provider,{value:{componentName:"UserVerification",...e,routing:"virtual"},children:(0,i.tZ)("div",{children:(0,i.tZ)(U,{...e,routing:"virtual"})})})})}}]);